(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6909:function(e,s,t){Promise.resolve().then(t.bind(t,2570))},2570:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return eN}});var a=t(7437),r=t(2265),l=t(7796),i=t(1994),n=t(3335);function c(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,n.m6)((0,i.W)(s))}let o=r.forwardRef((e,s)=>{let{className:t,value:r,...i}=e;return(0,a.jsx)(l.fC,{ref:s,className:c("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...i,children:(0,a.jsx)(l.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});o.displayName=l.fC.displayName;var d=t(535);let m=(0,d.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function x(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:c(m({variant:t}),s),...r})}var h=t(7414),u=t(4972),g=t(8896),p=t(1723),b=t(9474),j=t(8239),f=t(8614),y=t(5293);let w=(0,d.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),N=r.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:i=!1,...n}=e,o=i?y.g7:"button";return(0,a.jsx)(o,{className:c(w({variant:r,size:l,className:t})),ref:s,...n})});N.displayName="Button";let v=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r})});v.displayName="Card";let k=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("flex flex-col space-y-1.5 p-6",t),...r})});k.displayName="CardHeader";let S=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("text-2xl font-semibold leading-none tracking-tight",t),...r})});S.displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let C=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("p-6 pt-0",t),...r})});C.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:c("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var q=t(6858);function P(e){let{onNext:s}=e,[t,l]=(0,r.useState)(!1);return t?(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)(j.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:(0,a.jsxs)(v,{className:"shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50",children:[(0,a.jsxs)(k,{className:"pb-4",children:[(0,a.jsx)("div",{className:"mx-auto w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(b.Z,{className:"h-10 w-10 text-white"})}),(0,a.jsx)(S,{className:"text-3xl font-bold text-gray-900 mb-2",children:"The Knapsack Challenge"})]}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-sm",children:[(0,a.jsx)("p",{className:"text-lg text-gray-700 mb-6",children:"To win the prize, you will be asked to complete quizzes containing algorithm puzzles that are canonically called the 0-1 knapsack puzzle. Your performance on the quizzes will determine the chances you win the prizes. In the next section, we will explain what the knapsack questions is and give you opportunities to familiarize with sample questions you might see in the quizzes after."}),(0,a.jsxs)(N,{onClick:s,size:"lg",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-8 py-3 text-lg",children:["Continue to Instructions",(0,a.jsx)(q.Z,{className:"ml-2 h-5 w-5"})]})]})})]})})}):(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsx)(j.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:(0,a.jsxs)(v,{className:"text-center shadow-lg border-0 bg-gradient-to-br from-blue-50 to-indigo-50",children:[(0,a.jsxs)(k,{className:"pb-4",children:[(0,a.jsx)("div",{className:"mx-auto w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(h.Z,{className:"h-10 w-10 text-white"})}),(0,a.jsx)(S,{className:"text-3xl font-bold text-gray-900 mb-2",children:"Welcome to Our Experiment"})]}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-8 shadow-sm",children:[(0,a.jsx)("p",{className:"text-lg text-gray-700 mb-6",children:"Thank you for participating in our experiment. In the experiment, you will be asked to complete a series of questions for chances to win a prize! You may click next to begin the experiment."}),(0,a.jsxs)(N,{onClick:()=>l(!0),size:"lg",className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-8 py-3 text-lg",children:["Next",(0,a.jsx)(q.Z,{className:"ml-2 h-5 w-5"})]})]})})]})})})}var T=t(4794),I=t(1671),E=t(9388),A=t(9322),R=t(5252),Z=t(9232),F=t(4410),z=t(5368);function Q(e){let{question:s,onAnswer:t,onSkip:l,showSolution:i=!1,isInteractive:n=!0,isTestMode:c=!1,timeLimit:o,onTimeUp:d,initialSelection:m=[],isConfirmed:h=!1}=e,[u,g]=(0,r.useState)(m),[p,b]=(0,r.useState)(h),[y,w]=(0,r.useState)(o||0),[v,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{g(m),b(h)},[s.id]),(0,r.useEffect)(()=>{if(o&&y>0&&!p){let e=setInterval(()=>{w(e=>(e<=16&&e>15&&k(!0),e<=1)?(null==d||d(),0):e-1)},1e3);return()=>clearInterval(e)}},[o,p]),(0,r.useEffect)(()=>{o&&w(o)},[o]);let S=e=>{if(!n||p){console.log("Cannot toggle - not interactive or already submitted");return}console.log("Toggling ball:",e),g(s=>{let t=s.includes(e)?s.filter(s=>s!==e):[...s,e];return console.log("New selection:",t),t})},C=e=>e.reduce((e,t)=>{let a=s.balls.find(e=>e.id===t);return a&&(e.weight+=a.weight,e.reward+=a.reward),e},{weight:0,reward:0}),q=C(u),P=s.solution?C(s.solution):null,T=q.weight>s.capacity;return(0,a.jsxs)("div",{className:"space-y-6",children:[o&&(0,a.jsx)(j.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex justify-center",children:(0,a.jsx)("div",{className:"px-4 py-2 rounded-xl border-2 shadow-lg ".concat(y<=15?"border-red-500 bg-red-50":"border-blue-500 bg-blue-50"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(j.E.div,{animate:{scale:y<=15?[1,1.2,1]:1},transition:{repeat:y<=15?1/0:0,duration:1},className:"w-3 h-3 rounded-full ".concat(y<=15?"bg-red-500":"bg-blue-500")}),(0,a.jsx)("span",{className:"font-mono text-lg font-bold ".concat(y<=15?"text-red-700":"text-blue-700"),children:(e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))})(y)})]})})}),(0,a.jsx)(f.M,{children:v&&(0,a.jsx)(j.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl text-center",children:"⚠️ 15 seconds remaining! Remember to confirm your answer!"})}),(0,a.jsxs)("div",{className:"bg-gradient-to-br from-slate-50 to-gray-100 rounded-2xl p-6 border border-gray-200 shadow-lg",children:[(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsxs)("div",{className:"inline-flex items-center space-x-2 bg-white rounded-xl px-4 py-2 shadow-md border",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Capacity:"}),(0,a.jsx)("span",{className:"text-2xl font-bold text-gray-900",children:s.capacity})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsx)(j.E.div,{whileHover:{scale:1.02},className:"p-4 rounded-xl border-2 transition-all duration-200 ".concat(c||!T?"bg-blue-50 border-blue-200 text-blue-800":"bg-red-50 border-red-200 text-red-800"),children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg ".concat(c||!T?"bg-blue-100":"bg-red-100"),children:(0,a.jsx)(F.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-medium opacity-80",children:"Total Weight"}),(0,a.jsxs)("div",{className:"text-2xl font-bold",children:[q.weight," / ",s.capacity]})]})]})}),(0,a.jsx)(j.E.div,{whileHover:{scale:1.02},className:"p-4 rounded-xl bg-emerald-50 border-2 border-emerald-200 text-emerald-800",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 rounded-lg bg-emerald-100",children:(0,a.jsx)(Z.Z,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-medium opacity-80",children:"Total Reward"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:q.reward})]})]})})]}),(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 bg-white/60 rounded-full px-4 py-2 inline-block",children:["Click items to select • Selected: ",u.length," items"]})}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6",children:s.balls.map((e,t)=>{var r;let l=u.includes(e.id),c=i&&(null===(r=s.solution)||void 0===r?void 0:r.includes(e.id));return(0,a.jsx)(j.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},whileHover:n&&!p?{scale:1.05}:{},whileTap:n&&!p?{scale:.95}:{},className:"relative",children:(0,a.jsxs)("div",{className:"\n                    relative p-4 rounded-2xl border-2 transition-all duration-300 cursor-pointer\n                    ".concat(l?"bg-white border-blue-400 shadow-xl ring-4 ring-blue-200 ring-opacity-50":c?"bg-white border-green-400 shadow-xl ring-4 ring-green-200 ring-opacity-50":"bg-white border-gray-200 shadow-md hover:shadow-lg hover:border-gray-300","\n                    ").concat(!n||p?"cursor-default":"","\n                  "),onClick:()=>S(e.id),children:[(0,a.jsx)("div",{className:"flex justify-center mb-2",children:(0,a.jsx)("div",{className:"\n                        w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-lg\n                        ".concat(e.color,"\n                        ").concat(l?"ring-4 ring-white ring-opacity-50":"","\n                      "),children:e.id})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[(0,a.jsx)(F.Z,{className:"h-5 w-5 text-gray-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"Weight"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-700",children:e.weight})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 mb-1",children:[(0,a.jsx)(Z.Z,{className:"h-5 w-5 text-amber-600"}),(0,a.jsx)("span",{className:"text-sm font-medium text-amber-600",children:"Reward"})]}),(0,a.jsx)("div",{className:"text-2xl font-bold text-amber-600",children:e.reward})]})]}),l&&(0,a.jsx)(j.E.div,{initial:{scale:0},animate:{scale:1},className:"absolute -top-2 -right-2 w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center shadow-lg",children:(0,a.jsx)(I.Z,{className:"w-4 h-4 text-white"})}),c&&!l&&(0,a.jsx)(j.E.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute -top-2 -right-2",children:(0,a.jsx)(x,{className:"bg-green-500 text-white text-xs",children:"Solution"})})]})},e.id)})}),n&&!p&&(0,a.jsxs)(j.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex justify-center space-x-4",children:[(0,a.jsx)(N,{onClick:()=>{b(!0);let e=!1;if(s.solution&&!T){let t=s.solution.reduce((e,t)=>{let a=s.balls.find(e=>e.id===t);return e+((null==a?void 0:a.reward)||0)},0);e=u.reduce((e,t)=>{let a=s.balls.find(e=>e.id===t);return e+((null==a?void 0:a.reward)||0)},0)===t}null==t||t(u,e)},disabled:0===u.length,size:"lg",className:"\n                px-8 py-3 rounded-xl font-semibold shadow-lg transition-all duration-200\n                ".concat(!c&&T?"bg-red-500 hover:bg-red-600":"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700","\n                disabled:opacity-50 disabled:cursor-not-allowed\n              "),children:!c&&T?"Confirm Answer (Over Capacity)":"Confirm Answer"}),l&&(0,a.jsx)(N,{onClick:l,variant:"outline",size:"lg",className:"px-8 py-3 rounded-xl font-semibold border-2 hover:bg-gray-50 transition-all duration-200",children:"Skip Question"})]}),p&&(0,a.jsx)(j.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"text-center",children:(0,a.jsxs)("div",{className:"inline-flex items-center space-x-2 bg-green-500 text-white px-6 py-3 rounded-xl shadow-lg",children:[(0,a.jsx)(I.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-semibold",children:"Answer Confirmed"})]})}),i&&s.solution&&P&&(0,a.jsxs)(j.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 p-6 bg-gradient-to-r from-green-50 to-emerald-50 border-2 border-green-200 rounded-2xl",children:[(0,a.jsxs)("h4",{className:"font-bold text-green-800 mb-4 flex items-center text-lg",children:[(0,a.jsx)(I.Z,{className:"h-6 w-6 mr-2"}),"Optimal Solution"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl p-3 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"Selected Items"}),(0,a.jsx)("div",{className:"text-lg font-bold text-green-800",children:s.solution.join(", ")})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-3 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"Total Weight"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-green-800",children:[P.weight,"/",s.capacity]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-3 text-center",children:[(0,a.jsx)("div",{className:"text-sm text-green-600 font-medium",children:"Total Reward"}),(0,a.jsx)("div",{className:"text-lg font-bold text-green-800",children:P.reward})]})]}),s.explanation&&(0,a.jsx)("p",{className:"text-green-700 text-center bg-white rounded-xl p-4 italic",children:s.explanation})]})]})]})}let D=[{id:1,capacity:10,balls:[{id:1,weight:6,reward:30,color:"bg-red-500"},{id:2,weight:3,reward:14,color:"bg-blue-500"},{id:3,weight:4,reward:16,color:"bg-green-500"},{id:4,weight:2,reward:9,color:"bg-yellow-500"}],solution:[2,3,4],explanation:"Select balls 2, 3, and 4 for a total weight of 9 (≤10) and reward of 39 points."},{id:2,capacity:15,balls:[{id:1,weight:10,reward:60,color:"bg-purple-500"},{id:2,weight:20,reward:100,color:"bg-pink-500"},{id:3,weight:15,reward:120,color:"bg-indigo-500"}],solution:[3],explanation:"Select ball 3 for maximum reward of 120 points with weight exactly 15."}],M=[{id:"tutorial1",capacity:8,balls:[{id:1,weight:5,reward:20,color:"bg-red-500"},{id:2,weight:3,reward:18,color:"bg-blue-500"},{id:3,weight:4,reward:22,color:"bg-green-500"},{id:4,weight:2,reward:8,color:"bg-yellow-500"}],solution:[2,3],title:"Example 1"},{id:"tutorial2",capacity:12,balls:[{id:1,weight:6,reward:25,color:"bg-purple-500"},{id:2,weight:4,reward:20,color:"bg-pink-500"},{id:3,weight:8,reward:35,color:"bg-indigo-500"},{id:4,weight:3,reward:12,color:"bg-cyan-500"}],solution:[2,3],title:"Example 2"}];function O(){let[e,s]=(0,r.useState)(0),[t,l]=(0,r.useState)([]),[i,n]=(0,r.useState)({type:"none",message:""}),c=M[e],o=t.reduce((e,s)=>e+c.balls.find(e=>e.id===s).weight,0),d=t.reduce((e,s)=>e+c.balls.find(e=>e.id===s).reward,0),m=()=>{l([]),n({type:"none",message:""})},h=e=>{let s=t.includes(e)?t.filter(s=>s!==e):[...t,e];l(s);let a=s.reduce((e,s)=>e+c.balls.find(e=>e.id===s).weight,0),r=s.reduce((e,s)=>e+c.balls.find(e=>e.id===s).reward,0);if(a>c.capacity){n({type:"too_heavy",message:"Oops, the balls are too heavy! Try a different combination."});return}s.length===c.solution.length&&c.solution.every(e=>s.includes(e))?n({type:"success",message:"Nice! This is just right! You found the optimal solution."}):s.length>0&&r<c.solution.reduce((e,s)=>e+c.balls.find(e=>e.id===s).reward,0)?n({type:"suboptimal",message:"Oops, some other combination will give you more reward!"}):n({type:"none",message:""})};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold",children:c.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(N,{variant:"outline",size:"sm",onClick:()=>{e>0&&(s(e-1),m())},disabled:0===e,children:"Previous"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e+1," of ",M.length]}),(0,a.jsx)(N,{variant:"outline",size:"sm",onClick:()=>{e<M.length-1&&(s(e+1),m())},disabled:e===M.length-1,children:"Next"})]})]}),(0,a.jsxs)(v,{className:"border-2 border-gray-300",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)(T.Z,{className:"h-5 w-5 mr-2"}),"Capacity: ",c.capacity]}),(0,a.jsxs)(x,{variant:"secondary",children:["Weight: ",o,"/",c.capacity]})]})}),(0,a.jsxs)(C,{className:"space-y-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3",children:c.balls.map(e=>(0,a.jsxs)(j.E.div,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>h(e.id),className:"\n                  relative cursor-pointer rounded-lg p-3 border-2 transition-all\n                  ".concat(t.includes(e.id)?"border-gray-800 shadow-lg ring-2 ring-blue-500":"border-gray-300 hover:border-gray-400","\n                "),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full ".concat(e.color," mx-auto mb-2 flex items-center justify-center text-white font-bold text-xs"),children:e.id}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"font-bold text-sm",children:["W: ",e.weight]}),(0,a.jsxs)("div",{className:"text-yellow-600 font-bold text-sm",children:["R: ",e.reward]})]}),t.includes(e.id)&&(0,a.jsx)("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(I.Z,{className:"w-3 h-3 text-white"})})]},e.id))}),(0,a.jsxs)("div",{className:"bg-gray-100 p-3 rounded-lg text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"font-medium",children:"Selected:"}),(0,a.jsx)("span",{className:"text-gray-600",children:t.length>0?t.join(", "):"None"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Reward:"}),(0,a.jsxs)("span",{className:"text-yellow-600 font-bold",children:[d," points"]})]})]}),(0,a.jsx)("div",{className:"flex space-x-2",children:(0,a.jsx)(N,{variant:"outline",size:"sm",onClick:m,disabled:0===t.length,children:"Reset"})}),(0,a.jsx)(f.M,{mode:"wait",children:"none"!==i.type&&(0,a.jsx)(j.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-3 rounded-lg border-2 text-sm ".concat("success"===i.type?"bg-green-50 border-green-200 text-green-800":"too_heavy"===i.type?"bg-red-50 border-red-200 text-red-800":"bg-orange-50 border-orange-200 text-orange-800"),children:(0,a.jsxs)("div",{className:"flex items-center",children:["success"===i.type&&(0,a.jsx)(I.Z,{className:"h-4 w-4 mr-2 text-green-600"}),"too_heavy"===i.type&&(0,a.jsx)(E.Z,{className:"h-4 w-4 mr-2 text-red-600"}),"suboptimal"===i.type&&(0,a.jsx)(A.Z,{className:"h-4 w-4 mr-2 text-orange-600"}),(0,a.jsx)("span",{className:"font-medium",children:i.message})]})})})]})]})]})}function W(e){let{onNext:s}=e,[t,l]=(0,r.useState)(0),[i,n]=(0,r.useState)(!1),[c,o]=(0,r.useState)(0),d=[{title:"Welcome to the Knapsack Experiment",content:(0,a.jsx)("div",{className:"max-w-4xl mx-auto space-y-8",children:(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-8 rounded-xl border-2 border-blue-200",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,a.jsx)(T.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"The Knapsack Problem"})]}),(0,a.jsx)("p",{className:"text-xl text-gray-700 max-w-3xl mx-auto leading-relaxed",children:'You will be answering a series of questions, each presenting what\'s called a "knapsack problem." These are classic optimization puzzles where you need to make strategic choices to maximize your score.'})]})}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-green-50 to-yellow-50 p-8 rounded-xl border-2 border-green-200",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3",children:[(0,a.jsx)(R.Z,{className:"h-8 w-8 text-green-600"}),(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-900",children:"Monetary Rewards"})]}),(0,a.jsxs)("p",{className:"text-xl text-gray-700 max-w-3xl mx-auto leading-relaxed",children:[(0,a.jsx)("strong",{children:"The more questions you answer correctly, the higher monetary reward you will receive."}),"Your performance directly impacts your compensation, so it pays to think carefully about each decision!"]}),(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm max-w-lg mx-auto",children:(0,a.jsxs)("p",{className:"text-lg text-gray-600",children:["\uD83D\uDCDA ",(0,a.jsx)("strong",{children:"Don't worry!"})," We will have opportunities to practice before results count."]})})]})})]})})},{title:"How to do the Knapsack Problem",content:(0,a.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"In every question, you will see:"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(v,{className:"border-2 border-blue-200",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-base",children:[(0,a.jsx)(T.Z,{className:"h-4 w-4 mr-2 text-blue-600"}),"A Knapsack"]})}),(0,a.jsxs)(C,{className:"pt-0",children:[(0,a.jsxs)("p",{className:"text-gray-600 text-sm",children:["Has a ",(0,a.jsx)("strong",{children:"capacity (C)"})," - the maximum weight it can hold"]}),(0,a.jsx)("div",{className:"mt-2 p-2 bg-blue-50 rounded-lg",children:(0,a.jsx)("span",{className:"text-xs font-medium",children:"Example: Capacity = 10"})})]})]}),(0,a.jsxs)(v,{className:"border-2 border-green-200",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-base",children:[(0,a.jsx)(Z.Z,{className:"h-4 w-4 mr-2 text-green-600"}),"Colored Balls"]})}),(0,a.jsxs)(C,{className:"pt-0",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-2 text-sm",children:"Each ball has two properties:"}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(F.Z,{className:"h-3 w-3 mr-2 text-gray-500"}),(0,a.jsxs)("span",{className:"text-xs",children:[(0,a.jsx)("strong",{children:"Weight (W):"})," How heavy it is"]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(Z.Z,{className:"h-3 w-3 mr-2 text-yellow-500"}),(0,a.jsxs)("span",{className:"text-xs",children:[(0,a.jsx)("strong",{children:"Reward (R):"})," Points you earn"]})]})]})]})]})]})]})}),(0,a.jsxs)("div",{className:"bg-gray-50 p-6 rounded-xl border-2 border-gray-200",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-4 text-center",children:"Try it yourself!"}),(0,a.jsx)("p",{className:"text-center text-gray-700 mb-6",children:"Here's what a question will look like. Click on the balls to select them and see what happens:"}),(0,a.jsx)(O,{})]})]})},{title:"Your Goals and Scoring",content:(0,a.jsx)("div",{className:"max-w-4xl mx-auto space-y-8",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 p-8 rounded-xl border-2 border-yellow-200",children:[(0,a.jsx)("h3",{className:"text-3xl font-bold text-gray-900 mb-6 text-center",children:"Maximize Your Reward Points!"}),(0,a.jsx)("p",{className:"text-xl text-gray-700 mb-8 text-center max-w-3xl mx-auto",children:"Select balls to collect the most reward points possible without exceeding the knapsack's capacity."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,a.jsx)("h4",{className:"font-semibold text-green-700 mb-4 text-xl",children:"✓ For Every Question"}),(0,a.jsxs)("ul",{className:"text-lg text-gray-600 space-y-3",children:[(0,a.jsx)("li",{children:"• Click once to select a ball, click on a selected ball again to deselect"}),(0,a.jsx)("li",{children:"• Find the combination of selected balls that maximizes the reward while keeping combined weights below capacity"}),(0,a.jsx)("li",{children:'• Once you think you have the right selection, click "confirm answer" to lock in your selection'})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-700 mb-4 text-xl",children:"\uD83C\uDFAF Scoring"}),(0,a.jsxs)("ul",{className:"text-lg text-gray-600 space-y-3",children:[(0,a.jsx)("li",{children:"• Answer is considered correct if and only if you find the most optimal selection of balls"}),(0,a.jsx)("li",{children:"• All-or-nothing scoring system"}),(0,a.jsx)("li",{children:"• Partial credit is not awarded"})]})]})]})]})})}];if(i){let e=D[c];return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(S,{className:"flex items-center text-2xl",children:[(0,a.jsx)(z.Z,{className:"h-8 w-8 mr-3 text-blue-600"}),"Sample Question ",c+1," of ",D.length]}),(0,a.jsx)(x,{variant:"outline",className:"text-lg px-4 py-2",children:"Tutorial"})]})}),(0,a.jsxs)(C,{className:"space-y-8 p-8",children:[(0,a.jsx)(Q,{question:e,showSolution:!0,isInteractive:!1}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(N,{variant:"outline",onClick:()=>o(Math.max(0,c-1)),disabled:0===c,children:"Previous Example"}),(0,a.jsxs)(N,{onClick:()=>{c<D.length-1?o(c+1):s()},children:[c===D.length-1?"Start Practice":"Next Example",(0,a.jsx)(q.Z,{className:"ml-2 h-4 w-4"})]})]})]})]})})}return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(S,{className:"text-3xl font-bold",children:d[t].title}),(0,a.jsxs)(x,{variant:"outline",className:"text-lg px-4 py-2",children:["Step ",t+1," of ",d.length]})]})}),(0,a.jsxs)(C,{className:"p-8",children:[(0,a.jsx)(f.M,{mode:"wait",children:(0,a.jsx)(j.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:d[t].content},t)}),(0,a.jsxs)("div",{className:"flex justify-between mt-8",children:[(0,a.jsx)(N,{variant:"outline",onClick:()=>l(Math.max(0,t-1)),disabled:0===t,children:"Previous"}),(0,a.jsxs)(N,{onClick:()=>{t<d.length-1?l(t+1):n(!0)},children:[t===d.length-1?"See Examples":"Next",(0,a.jsx)(q.Z,{className:"ml-2 h-4 w-4"})]})]})]})]})})}var L=t(1239),Y=t(6865);let B=t(257).env.NEXT_PUBLIC_API_BASE||"https://knapsack-expirement.onrender.com";async function U(e){let s=new AbortController,t=setTimeout(()=>s.abort(),3e4);try{let a=await fetch("".concat(B,"/api/v1/questions/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:s.signal});if(clearTimeout(t),!a.ok){let e=await a.json();throw console.error("[generateQuestions] failed",e),Error(e.error||"Question generation failed")}return a.json()}catch(e){if(clearTimeout(t),"AbortError"===e.name)throw Error("Question generation timed out after 30 seconds");throw e}}async function _(e,s){let t=new AbortController,a=setTimeout(()=>t.abort(),15e3);try{let r=await fetch("".concat(B,"/api/v1/questions/").concat(e,"/").concat(s),{method:"GET",headers:{"Content-Type":"application/json"},signal:t.signal});if(clearTimeout(a),!r.ok){let e=await r.json();throw console.error("[getQuestions] failed",e),Error(e.error||"Failed to retrieve questions")}return r.json()}catch(e){if(clearTimeout(a),"AbortError"===e.name)throw Error("Question retrieval timed out after 15 seconds");throw e}}async function G(e){try{let s=await _(e.participantId,e.phase);return console.log("[getOrGenerateQuestions] Found existing questions for ".concat(e.phase,":"),s.questionSet.questions.length),s.questionSet.questions}catch(t){console.log("[getOrGenerateQuestions] No existing questions found, generating new ones for ".concat(e.phase));let s=await U(e);return console.log("[getOrGenerateQuestions] Generated ".concat(s.questionsGenerated," questions")),(await _(e.participantId,e.phase)).questionSet.questions}}let H=["bg-red-500","bg-blue-500","bg-green-500","bg-yellow-500","bg-purple-500","bg-pink-500","bg-indigo-500","bg-orange-500","bg-teal-500","bg-rose-500","bg-cyan-500","bg-lime-500","bg-amber-500","bg-emerald-500","bg-violet-500","bg-sky-500","bg-stone-500","bg-slate-500","bg-gray-500","bg-zinc-500"];function J(e,s){let t=e.length,a=Array(t+1).fill(null).map(()=>Array(s+1).fill(0));for(let r=1;r<=t;r++)for(let t=0;t<=s;t++){let s=e[r-1];s.weight<=t?a[r][t]=Math.max(a[r-1][t],a[r-1][t-s.weight]+s.reward):a[r][t]=a[r-1][t]}let r=[],l=s,i=0;for(let s=t;s>0&&l>0;s--)a[s][l]!==a[s-1][l]&&(r.push(e[s-1].id),i+=e[s-1].weight,l-=e[s-1].weight);return{solution:r.reverse(),maxReward:a[t][s],solutionWeight:i}}function K(e,s){let t=0;for(;t<100;){let a;switch(t++,s.difficultyLevel){case"easy":a="full";break;case"medium":a="partial";break;case"hard":a="none"}let r=function(e,s){let t=[];switch(s){case"full":for(let s=0;s<e.numItems;s++)t.push({id:s+1,weight:e.minWeight+2*s,reward:e.maxReward-3*s,color:H[s%H.length]});break;case"partial":for(let s=0;s<e.numItems;s++){let a,r;s<Math.floor(e.numItems/2)?(a=e.minWeight+2*s,r=e.maxReward-2*s):(a=e.minWeight+Math.floor(Math.random()*(e.maxWeight-e.minWeight)),r=e.minReward+Math.floor(Math.random()*(e.maxReward-e.minReward))),t.push({id:s+1,weight:a,reward:r,color:H[s%H.length]})}break;case"none":for(let s=0;s<e.numItems;s++)t.push({id:s+1,weight:e.minWeight+Math.floor(Math.random()*(e.maxWeight-e.minWeight)),reward:e.minReward+Math.floor(Math.random()*(e.maxReward-e.minReward)),color:H[s%H.length]})}return t}(s,a),l=function(e,s){let t=e.reduce((e,s)=>e+s.weight,0);return s?Math.floor(t*s):Math.floor(.7*t)}(r,s.targetSlackRatio),i=J(r,l);if(0===i.solution.length||s.ensureUniqueSolution&&!function(e,s){let t=J(e,s),a=0;for(let r=0;r<1<<e.length;r++){let l=0,i=0;for(let s=0;s<e.length;s++)r&1<<s&&(l+=e[s].weight,i+=e[s].reward);if(l<=s&&i===t.maxReward&&++a>1)return!1}return 1===a}(r,l))continue;let n=function(e,s,t){let{removedCount:a}=function(e){let s=[];for(let t of e){let a=!1;for(let s of e)if(t.id!==s.id&&s.weight<=t.weight&&s.reward>=t.reward&&(s.weight<t.weight||s.reward>t.reward)){a=!0;break}a||s.push(t)}return{filtered:s,removedCount:e.length-s.length}}(e),r=s/e.reduce((e,s)=>e+s.weight,0),l=e.map(e=>e.reward/e.weight),i=l.reduce((e,s)=>e+s,0)/l.length,n=l.reduce((e,s)=>e+Math.pow(s-i,2),0)/l.length,c=J(e,s),o=0,d=new Set(t);for(let t=0;t<1<<e.length;t++){let a=[],r=0,l=0;for(let s=0;s<e.length;s++)t&1<<s&&(a.push(e[s].id),r+=e[s].weight,l+=e[s].reward);!(r>s)&&(a.length===d.size&&a.every(e=>d.has(e))||(o=Math.max(o,l)))}return{dominanceCount:a,slackRatio:r,optimalityGap:c.maxReward-o,densityVariance:n}}(r,l,i.solution),c="The optimal selection maximizes reward (".concat(i.maxReward,") while staying within capacity (").concat(i.solutionWeight,"/").concat(l,").");return{id:e,capacity:l,balls:r,solution:i.solution,explanation:c,difficulty:s.difficultyLevel,metadata:n}}throw Error("Failed to generate valid question after ".concat(100," attempts"))}function X(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=[],a=["easy","medium","hard"];for(let r=0;r<e;r++){let e=a[r%a.length],l={numItems:4+Math.floor(r/3),minWeight:3,maxWeight:15,minReward:9,maxReward:45,difficultyLevel:e,ensureUniqueSolution:!0,...s};try{let e=K(r+1,l);t.push(e)}catch(s){console.warn("Failed to generate question ".concat(r+1,":"),s);let e=K(r+1,{...l,ensureUniqueSolution:!1});t.push(e)}}return t}let V={training:{numItems:3,minWeight:3,maxWeight:8,minReward:9,maxReward:24,ensureUniqueSolution:!0},benchmark:{numItems:5,minWeight:4,maxWeight:12,minReward:12,maxReward:36,ensureUniqueSolution:!0},prediction:{numItems:6,minWeight:5,maxWeight:15,minReward:15,maxReward:45,ensureUniqueSolution:!0}};function $(e,s,t){let a;switch(void 0!==t&&(Math.random=()=>{let e=1e4*Math.sin(t++);return e-Math.floor(e)}),e){case"training":a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3;return X(e,{...V.training,difficultyLevel:"easy"})}(s||3);break;case"benchmark":a=function(e){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(s)return[...e];let t=[...e];for(let e=t.length-1;e>0;e--){let s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}(a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,s=[],t=["easy","medium","hard"];for(let a=0;a<e;a++){let e=t[a%t.length],r={...V.benchmark,difficultyLevel:e,numItems:"easy"===e?4:"medium"===e?5:6};try{let e=K(a+1,r);s.push(e)}catch(t){console.warn("Failed to generate benchmark question ".concat(a+1,", using fallback"));let e=K(a+1,{...r,ensureUniqueSolution:!1});s.push(e)}}return s}(s||10),!1);break;case"prediction":a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,s=[],t=["hard","hard","medium","medium","easy","easy","easy","easy"];for(let a=0;a<Math.min(e,t.length);a++){let e=t[a],r={...V.prediction,difficultyLevel:e,numItems:"hard"===e?6:"medium"===e?5:4};try{let e=K(a+1,r);s.push(e)}catch(t){console.warn("Failed to generate prediction question ".concat(a+1,", using fallback"));let e=K(a+1,{...r,ensureUniqueSolution:!1});s.push(e)}}return s}(s||8);break;default:throw Error("Unknown phase: ".concat(e))}let r=function(e){let s=[],t=e.map(e=>e.id),a=new Set(t);t.length!==a.size&&s.push("Duplicate question IDs found"),e.forEach((e,t)=>{e.solution&&0!==e.solution.length||s.push("Question ".concat(t+1," has no solution")),0===e.balls.length&&s.push("Question ".concat(t+1," has no items")),e.capacity<=0&&s.push("Question ".concat(t+1," has invalid capacity"))});let r=function(e){let s={easy:0,medium:0,hard:0},t=0,a=0,r=0;e.forEach(e=>{"easy"===e.difficulty?s.easy++:"medium"===e.difficulty?s.medium++:"hard"===e.difficulty&&s.hard++,e.metadata&&(t+=e.metadata.dominanceCount,a+=e.metadata.slackRatio,r+=e.metadata.optimalityGap)});let l=e.length;return{easyCount:s.easy,mediumCount:s.medium,hardCount:s.hard,averageDominance:t/l,averageSlackRatio:a/l,averageOptimalityGap:r/l}}(e);return 0===r.easyCount&&0===r.mediumCount&&0===r.hardCount&&s.push("No difficulty levels assigned"),{isValid:0===s.length,issues:s}}(a);return r.isValid||console.warn("Generated question set has issues:",r.issues),a}var ee=t(257);function es(e){let{onNext:s,updateParticipantData:t}=e,[l,i]=(0,r.useState)(0),[n,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!1),[h,u]=(0,r.useState)(null),[p,b]=(0,r.useState)(!0),[y,w]=(0,r.useState)(null),[q,P]=(0,r.useState)(!1),[T,A]=(0,r.useState)([]),[R,Z]=(0,r.useState)(!0),[F,z]=(0,r.useState)(null),[D,M]=(0,r.useState)(null);(0,r.useEffect)(()=>{console.log("[Practice] Loading participant ID from localStorage");try{let e=localStorage.getItem("participantId");console.log("[Practice] Stored participant ID:",e),M(e),e?console.log("[Practice] Set participant ID to:",e):console.warn("[Practice] No participantId in localStorage. Did registration run on page load?")}catch(e){console.error("[Practice] Failed to read participantId from localStorage",e)}},[]),(0,r.useEffect)(()=>{if(console.log("[Practice] useEffect triggered, pid:",D),!D){console.log("[Practice] No participant ID available, skipping question loading");return}(async()=>{console.log("[Practice] loadQuestions function called");let e=setTimeout(()=>{console.log("[Practice] Question loading timeout - trying local generation");try{let e=$("training",6);if(console.log("[Practice] Timeout fallback - generated local questions:",e),e&&e.length>0)A(e),Z(!1),z(null);else throw Error("Timeout fallback returned empty questions")}catch(e){console.error("[Practice] Timeout fallback also failed:",e);try{let e=X(6,{numItems:3,minWeight:2,maxWeight:8,minReward:6,maxReward:24,difficultyLevel:"easy",ensureUniqueSolution:!1});if(e&&e.length>0)A(e),Z(!1),z(null);else throw Error("Simple timeout fallback also failed")}catch(e){console.error("[Practice] Simple timeout fallback also failed:",e),z("Question generation timed out. Please refresh the page to try again."),Z(!1)}}},1e4);try{console.log("[Practice] Setting isLoadingQuestions to true"),Z(!0),z(null),console.log("[Practice] Loading dynamic questions for participant:",D);let s=await G({participantId:D,phase:"practice",count:6});clearTimeout(e),console.log("[Practice] Loaded questions:",s),A(s)}catch(s){clearTimeout(e),console.error("[Practice] Failed to load questions from backend:",s),z(s instanceof Error?s.message:"Failed to load questions from backend"),console.log("[Practice] Falling back to local question generation");try{console.log("[Practice] Calling createPhaseQuestions('training', 6)");let e=$("training",6);if(console.log("[Practice] Generated local questions:",e),console.log("[Practice] Number of questions generated:",e.length),e&&e.length>0)A(e),z(null),console.log("[Practice] Successfully set local questions");else throw Error("Local generation returned empty questions array")}catch(e){console.error("[Practice] Local question generation also failed:",e),console.error("[Practice] Local error details:",e);try{console.log("[Practice] Trying simpler question generation approach");let e=X(6,{numItems:3,minWeight:2,maxWeight:8,minReward:6,maxReward:24,difficultyLevel:"easy",ensureUniqueSolution:!1});if(console.log("[Practice] Simple questions generated:",e),e&&e.length>0)A(e),z(null),console.log("[Practice] Successfully set simple questions");else throw Error("Simple generation also returned empty array")}catch(e){console.error("[Practice] Simple generation also failed:",e),z("Failed to generate questions. Please refresh the page to try again.")}}}finally{clearTimeout(e),console.log("[Practice] Finally block executed - setting isLoadingQuestions to false"),Z(!1)}})()},[D]);let O=(0,r.useMemo)(()=>ee.env.NEXT_PUBLIC_API_BASE||"https://knapsack-expirement.onrender.com",[]),W=async()=>{if(D)try{Z(!0),w(!0),P(!0);let e=await G({participantId:D,phase:"practice-extra",count:4}),s=[...T,...e];A(s),i(T.length),w(null)}catch(e){console.error("[Practice] Failed to load extra questions:",e),w(null)}finally{Z(!1)}},B=async()=>{if(!D){alert("Participant not registered yet. Please refresh the page so we can register your session."),console.error("[Practice] handleComplete aborted: no participantId");return}let e=n.filter(e=>e.correct).length,a={phase:"practice",participantId:D,data:{completed:!0,correctAnswers:e,totalQuestions:n.length,accuracy:n.length?e/n.length:0,answers:n}};console.log("[Practice] Submitting payload →",a);try{let e=await fetch("".concat(O,"/api/v1/ingest-phase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await e.text(),l=null;try{l=JSON.parse(r)}catch(e){}if(console.log("[Practice] ingest-phase status:",e.status,"body:",r),!e.ok)throw Error((null==l?void 0:l.error)||"Failed to submit practice data (status ".concat(e.status,")"));t({training1:a.data}),s()}catch(e){console.error("[Practice] ingest-phase error:",e),console.log("[Practice] Backend unavailable, proceeding with local data only"),t({training1:a.data}),s()}};if(R)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsx)(C,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-2xl mb-4",children:(0,a.jsx)(L.Z,{className:"h-8 w-8 text-white animate-pulse"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Generating Dynamic Questions"}),(0,a.jsx)("p",{className:"text-gray-600 max-w-md mx-auto",children:"Creating personalized knapsack problems using our sophisticated academic algorithm..."}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-500"}),(0,a.jsx)("span",{children:"This may take a few moments"})]}),F&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:["Error: ",F,(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs",children:"Falling back to backup questions..."})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(N,{onClick:()=>{console.log("[Practice] Manual test - generating local questions");try{let e=$("training",6);if(console.log("[Practice] Test questions generated:",e),e&&e.length>0)A(e),Z(!1),z(null),console.log("[Practice] Test questions set successfully");else throw Error("Test generation returned empty array")}catch(e){console.error("[Practice] Test generation failed:",e);try{let e=X(6,{numItems:3,minWeight:2,maxWeight:8,minReward:6,maxReward:24,difficultyLevel:"easy",ensureUniqueSolution:!1});e&&e.length>0?(A(e),Z(!1),z(null),console.log("[Practice] Simple test questions set successfully")):z("Test generation failed - no questions generated")}catch(e){console.error("[Practice] Simple test generation also failed:",e),z("Test generation failed - please check console for details")}}},variant:"outline",size:"sm",children:"Test Local Generation"})})]})})})});if(p)return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[!D&&(0,a.jsxs)("div",{className:"mb-4 flex items-center gap-2 text-amber-700 bg-amber-50 border border-amber-200 rounded p-3",children:[(0,a.jsx)(Y.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"No participant ID yet. Make sure the page registered a participant on load."})]}),(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 mr-2 text-green-600"}),"Practice Round - Instructions"]})}),(0,a.jsxs)(C,{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-green-800 mb-6",children:"Welcome to the Practice Section!"}),(0,a.jsxs)("div",{className:"space-y-6 text-green-700",children:[(0,a.jsxs)("p",{className:"text-lg",children:["In this section, you can practice with dynamically generated questions. You will see a total of",(0,a.jsxs)("strong",{children:[" ",T.length," questions"]})," to help you get familiar with the knapsack puzzle."]}),F&&(0,a.jsx)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-yellow-800 text-sm",children:[(0,a.jsx)("strong",{children:"Note:"})," We encountered an issue generating questions dynamically, so we're using backup questions for this session."]})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"\uD83E\uDDE0 Dynamic Generation"}),(0,a.jsxs)("ul",{className:"text-base space-y-2",children:[(0,a.jsx)("li",{children:"• Questions are generated using academic algorithms"}),(0,a.jsx)("li",{children:"• Difficulty controlled by dominance relationships"}),(0,a.jsx)("li",{children:"• Each question has a unique optimal solution"}),(0,a.jsx)("li",{children:"• No time constraint - take your time to learn!"})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"\uD83C\uDFAF How to Play"}),(0,a.jsxs)("ul",{className:"text-base space-y-2",children:[(0,a.jsx)("li",{children:"• Click once to select a ball, click again to deselect"}),(0,a.jsx)("li",{children:"• Maximize reward while staying within capacity"}),(0,a.jsx)("li",{children:'• Click "confirm answer" to lock in your selection'}),(0,a.jsx)("li",{children:"• See solutions and explanations after each answer"})]})]})]})]})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(N,{onClick:()=>b(!1),size:"lg",className:"bg-green-600 hover:bg-green-700",children:"Start Practice Questions"})})]})]})]});if(null!==y){let e=n.filter(e=>e.correct).length,s=(n.length?e/n.length:0)*100;return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(I.Z,{className:"h-6 w-6 mr-2 text-green-600"}),"Practice Complete!"]})}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-8 rounded-xl",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Congratulations! You have completed the training."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Correct Answers"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:n.length}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total Questions"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsxs)("div",{className:"text-3xl font-bold text-purple-600",children:[s.toFixed(0),"%"]}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Accuracy"})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg border-2 border-blue-200 mb-6",children:[(0,a.jsx)("p",{className:"text-lg text-gray-800 mb-4",children:"You should now know how to complete knapsack problems effectively."}),(0,a.jsx)("p",{className:"text-base text-gray-700",children:"From this point on, you will be faced with different tests that are all on completing knapsack problems."})]}),(0,a.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[(0,a.jsx)("h4",{className:"font-semibold text-yellow-900 mb-2",children:"Would you like more practice?"}),(0,a.jsx)("p",{className:"text-yellow-800 text-sm mb-4",children:'If you wish to see additional problems, you can press "More Practice" which will allow you to see more knapsack practice questions.'}),(0,a.jsxs)("div",{className:"flex justify-center space-x-3",children:[(0,a.jsx)(N,{onClick:B,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:"Continue to Test 1"}),(0,a.jsx)(N,{onClick:W,variant:"outline",size:"lg",children:"More Practice"})]})]})]})})})]})})}if(!T.length)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsx)(C,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:"No questions available"})})})});let U=T[l],_=(l+1)/T.length*100;return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsx)(v,{children:(0,a.jsxs)(C,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Practice Question ",l+1," of ",T.length,q&&l>=6&&" (Extra Practice)"]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(x,{variant:"outline",children:"No Time Limit"}),D&&(0,a.jsxs)(x,{variant:"outline",children:["PID: ",D.slice(0,8),"…"]})]})]}),(0,a.jsx)(o,{value:_,className:"h-2"})]})}),(0,a.jsx)(f.M,{mode:"wait",children:d?(0,a.jsxs)(j.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"space-y-6",children:[(0,a.jsx)(v,{className:"border-2 ".concat((null==h?void 0:h.correct)?"border-green-500 bg-green-50":"border-red-500 bg-red-50"),children:(0,a.jsx)(C,{className:"p-6 text-center",children:(null==h?void 0:h.correct)?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(I.Z,{className:"h-12 w-12 text-green-600 mx-auto"}),(0,a.jsx)("h3",{className:"text-xl font-bold text-green-800",children:"Correct!"}),(0,a.jsx)("p",{className:"text-green-700",children:"You found the optimal solution. Great job!"})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(E.Z,{className:"h-12 w-12 text-red-600 mx-auto"}),(0,a.jsx)("h3",{className:"text-xl font-bold text-red-800",children:"Not Quite Right"}),(0,a.jsx)("p",{className:"text-red-700",children:"Don't worry! Let's see the optimal solution below."})]})})}),(0,a.jsx)(Q,{question:U,showSolution:!0,isInteractive:!1}),(0,a.jsxs)("div",{className:"text-center space-y-3",children:[(0,a.jsx)(N,{onClick:()=>{m(!1),u(null),l<T.length-1?i(l+1):w(!1)},size:"lg",children:l===T.length-1?"Complete Practice":"Next Question"}),q&&l>=6&&(0,a.jsx)("div",{children:(0,a.jsx)(N,{onClick:B,variant:"outline",size:"lg",className:"ml-4",children:"End Extra Practice & Continue to Test 1"})})]})]},"feedback-".concat(l)):(0,a.jsx)(j.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:(0,a.jsx)(Q,{question:U,onAnswer:(e,s)=>{let t={questionId:T[l].id,selected:e,correct:s};c(e=>[...e,t]),u({selected:e,correct:s}),m(!0)},isInteractive:!0})},"question-".concat(l))})]})}var et=t(257);let ea=[{id:1,capacity:10,balls:[{id:1,weight:6,reward:18,color:"bg-red-500"},{id:2,weight:4,reward:12,color:"bg-blue-500"},{id:3,weight:3,reward:9,color:"bg-green-500"}],solution:[1,2],difficulty:"easy"},{id:2,capacity:12,balls:[{id:1,weight:5,reward:15,color:"bg-purple-500"},{id:2,weight:7,reward:21,color:"bg-yellow-500"},{id:3,weight:4,reward:12,color:"bg-pink-500"},{id:4,weight:3,reward:9,color:"bg-indigo-500"}],solution:[2,3],difficulty:"easy"},{id:3,capacity:15,balls:[{id:1,weight:8,reward:24,color:"bg-red-500"},{id:2,weight:6,reward:18,color:"bg-blue-500"},{id:3,weight:5,reward:15,color:"bg-green-500"},{id:4,weight:4,reward:12,color:"bg-yellow-500"}],solution:[1,2],difficulty:"easy"},{id:4,capacity:18,balls:[{id:1,weight:9,reward:27,color:"bg-orange-500"},{id:2,weight:7,reward:21,color:"bg-teal-500"},{id:3,weight:6,reward:18,color:"bg-rose-500"},{id:4,weight:5,reward:15,color:"bg-cyan-500"},{id:5,weight:4,reward:12,color:"bg-lime-500"}],solution:[1,2],difficulty:"medium"},{id:5,capacity:20,balls:[{id:1,weight:10,reward:30,color:"bg-red-500"},{id:2,weight:8,reward:24,color:"bg-blue-500"},{id:3,weight:6,reward:18,color:"bg-green-500"},{id:4,weight:5,reward:15,color:"bg-yellow-500"},{id:5,weight:4,reward:12,color:"bg-purple-500"}],solution:[1,2],difficulty:"medium"},{id:6,capacity:22,balls:[{id:1,weight:12,reward:36,color:"bg-indigo-500"},{id:2,weight:10,reward:30,color:"bg-pink-500"},{id:3,weight:8,reward:24,color:"bg-orange-500"},{id:4,weight:6,reward:18,color:"bg-teal-500"},{id:5,weight:5,reward:15,color:"bg-rose-500"}],solution:[1,2],difficulty:"medium"},{id:7,capacity:25,balls:[{id:1,weight:15,reward:45,color:"bg-cyan-500"},{id:2,weight:12,reward:36,color:"bg-lime-500"},{id:3,weight:10,reward:30,color:"bg-amber-500"},{id:4,weight:8,reward:24,color:"bg-emerald-500"},{id:5,weight:6,reward:18,color:"bg-violet-500"}],solution:[1,4],difficulty:"medium"},{id:8,capacity:30,balls:[{id:1,weight:18,reward:54,color:"bg-red-500"},{id:2,weight:15,reward:45,color:"bg-blue-500"},{id:3,weight:12,reward:36,color:"bg-green-500"},{id:4,weight:10,reward:30,color:"bg-yellow-500"},{id:5,weight:8,reward:24,color:"bg-purple-500"},{id:6,weight:6,reward:18,color:"bg-pink-500"}],solution:[1,3],difficulty:"hard"},{id:9,capacity:35,balls:[{id:1,weight:20,reward:60,color:"bg-indigo-500"},{id:2,weight:18,reward:54,color:"bg-orange-500"},{id:3,weight:15,reward:45,color:"bg-teal-500"},{id:4,weight:12,reward:36,color:"bg-rose-500"},{id:5,weight:10,reward:30,color:"bg-cyan-500"},{id:6,weight:8,reward:24,color:"bg-lime-500"}],solution:[1,3],difficulty:"hard"},{id:10,capacity:40,balls:[{id:1,weight:25,reward:75,color:"bg-amber-500"},{id:2,weight:20,reward:60,color:"bg-emerald-500"},{id:3,weight:18,reward:54,color:"bg-violet-500"},{id:4,weight:15,reward:45,color:"bg-sky-500"},{id:5,weight:12,reward:36,color:"bg-stone-500"},{id:6,weight:10,reward:30,color:"bg-red-500"}],solution:[1,4],difficulty:"hard"}];function er(e){let{onNext:s,updateParticipantData:t}=e,[l,i]=(0,r.useState)(0),[n,c]=(0,r.useState)([]),[d,m]=(0,r.useState)(!0),[h,u]=(0,r.useState)(0),[g,y]=(0,r.useState)(900),[w,q]=(0,r.useState)(0),[P,T]=(0,r.useState)(!1),I=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(!d&&g>0&&!P){let e=setInterval(()=>{y(s=>s<=1?(clearInterval(e),A(),0):s-1)},1e3);return()=>clearInterval(e)}},[d,g,P]);let E=()=>{l<ea.length-1?(i(e=>e+1),q(Date.now())):R()},A=()=>{if(I.current)return;let e=ea.slice(l).map(e=>({questionId:e.id,selected:[],correct:!1,timeSpent:0}));c(s=>[...s,...e]),R()},R=async()=>{if(I.current)return;I.current=!0,T(!0);let e=n.filter(e=>e.correct).length,s={phase:"test1",participantId:localStorage.getItem("participantId"),data:{completed:!0,correctAnswers:e,totalQuestions:ea.length,accuracy:e/ea.length,timeUsed:900-g,answers:n}};try{let a=et.env.NEXT_PUBLIC_API_BASE||"https://knapsack-expirement.onrender.com";if(!(await fetch("".concat(a,"/api/v1/ingest-phase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw Error("Failed to submit test data");console.log("[Test 1] Submission successful ✅"),t({training2:s.data,totalScore:e})}catch(e){console.error("[Test 1] Submission failed ❌",e),alert("There was an error submitting your test results.")}},Z=ea[l],F=(l+1)/ea.length*100,z={easy:"bg-green-500",medium:"bg-yellow-500",hard:"bg-red-500"}[Z.difficulty];if(d)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(L.Z,{className:"h-6 w-6 mr-2 text-orange-600"}),"Test 1 - Instructions"]})}),(0,a.jsxs)(C,{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-orange-800 mb-6",children:"Test 1"}),(0,a.jsxs)("div",{className:"space-y-6 text-orange-700",children:[(0,a.jsxs)("p",{className:"text-xl",children:["In this section, you will complete ",(0,a.jsx)("strong",{children:"10 questions"})," in Test 1. Once you start, you will have ",(0,a.jsx)("strong",{children:"90 seconds on each question"}),"."]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg",children:[(0,a.jsxs)("h4",{className:"text-xl font-semibold mb-4 flex items-center",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 mr-2"}),"Rules"]}),(0,a.jsxs)("ul",{className:"text-lg space-y-3",children:[(0,a.jsx)("li",{children:"• You have 90 seconds to complete each question."}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"You cannot come back to previous questions after seeing later questions"}),", so answer questions you wish before moving on."]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Guessing is penalized!"})," Please only answer questions you wish to answer."]}),(0,a.jsx)("li",{children:"• Only questions confirmed are considered answered, unconfirmed questions are considered unanswered!"}),(0,a.jsx)("li",{children:"• Auto-submit when time runs out."})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg",children:[(0,a.jsxs)("h4",{className:"text-xl font-semibold mb-4 flex items-center",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5 mr-2"}),"Scoring"]}),(0,a.jsxs)("ul",{className:"text-lg space-y-3",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Correct answers"}),": You are rewarded 2 ",(0,a.jsx)("strong",{children:"probability points"})]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Incorrect answers"}),": You are NOT rewarded ",(0,a.jsx)("strong",{children:"probability points"})]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Unanswered questions"}),": You are rewarded 1 ",(0,a.jsx)("strong",{children:"probability point"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-red-100 border border-red-300 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"flex items-center mb-4",children:[(0,a.jsx)(Y.Z,{className:"h-5 w-5 text-red-600 mr-2"}),(0,a.jsx)("h4",{className:"text-xl font-semibold text-red-800",children:"Important Reminders"})]}),(0,a.jsxs)("ul",{className:"text-lg text-red-700 space-y-3",children:[(0,a.jsx)("li",{children:"• If you attempted a question but do not wish to answer it, no need to deselect the balls, just leave the question unconfirmed."}),(0,a.jsx)("li",{children:"• Focus on accuracy over speed."})]})]})]})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)(N,{onClick:()=>{m(!1),u(Date.now()),q(Date.now())},size:"lg",className:"bg-orange-600 hover:bg-orange-700",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 mr-2"}),"Start Test 1"]})})]})]})});if(P){let e=n.filter(e=>e.correct).length,t=n.filter(e=>0===e.selected.length).length,r=n.filter(e=>e.selected.length>0&&!e.correct).length;return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(b.Z,{className:"h-6 w-6 mr-2 text-green-600"}),"Test 1 Complete!"]})}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-8 rounded-xl",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Your Performance Summary"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Correct"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:t}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Unanswered"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-red-600",children:r}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Incorrect"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border-2 border-blue-500",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Probability Points Earned"})]})]}),(0,a.jsxs)("div",{className:"bg-blue-100 border border-blue-300 rounded-lg p-4 mb-6",children:[(0,a.jsxs)("p",{className:"text-blue-800 font-medium",children:["You earned ",(0,a.jsx)("strong",{children:e})," probability points!"]}),(0,a.jsx)("p",{className:"text-blue-700 text-sm mt-1",children:"Great job completing Test 1!"})]}),(0,a.jsx)(N,{onClick:s,size:"lg",children:"Continue to Test 2"})]})})})]})})}return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto space-y-6",children:[(0,a.jsx)(v,{children:(0,a.jsxs)(C,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:["Question ",l+1," of ",ea.length]}),(0,a.jsx)(x,{className:"text-white ".concat(z),children:Z.difficulty.toUpperCase()})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 px-3 py-1 rounded-lg ".concat(g<=300?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:[(0,a.jsx)(p.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-mono font-bold",children:(e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))})(g)})]})]}),(0,a.jsx)(o,{value:F,className:"h-2"})]})}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 text-center",children:(0,a.jsx)("p",{className:"text-red-700 font-medium text-sm",children:"\uD83D\uDEA8 Confirm answers or they will be considered unanswered!"})}),(0,a.jsx)(f.M,{mode:"wait",children:(0,a.jsx)(j.E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},children:(0,a.jsx)(Q,{question:Z,onAnswer:(e,s)=>{if(I.current)return;let t=Date.now()-w,a={questionId:ea[l].id,selected:e,correct:s,timeSpent:Math.round(t/1e3)};c(e=>[...e,a]),E()},onSkip:()=>{if(I.current)return;let e=Date.now()-w,s={questionId:ea[l].id,selected:[],correct:!1,timeSpent:Math.round(e/1e3)};c(e=>[...e,s]),E()},isInteractive:!0,isTestMode:!0,timeLimit:90,onTimeUp:()=>{let e=Date.now()-w,s={questionId:Z.id,selected:[],correct:!1,timeSpent:Math.round(e/1e3)};c(e=>[...e,s]),E()}})},"question-".concat(l))})]})}var el=t(6215),ei=t(6595),en=t(2451),ec=t(407);function eo(e){let{onNext:s,updateParticipantData:t}=e;console.log("[BenchmarkPhase] Component initializing");let[l,i]=(0,r.useState)([]),[n,c]=(0,r.useState)(0),[d,m]=(0,r.useState)({}),[h,u]=(0,r.useState)(new Set),[g,b]=(0,r.useState)(!0),[j,f]=(0,r.useState)(1200),[y,w]=(0,r.useState)(!1),[q,P]=(0,r.useState)(!1),[T,I]=(0,r.useState)(!0),[E,A]=(0,r.useState)(null),[R,Z]=(0,r.useState)(null),F="https://knapsack-expirement.onrender.com";(0,r.useEffect)(()=>{let e=localStorage.getItem("participantId");Z(e),e||console.warn("[Benchmark] No participantId in localStorage")},[]),(0,r.useEffect)(()=>{R&&(async()=>{try{I(!0),A(null),console.log("[Benchmark] Loading dynamic questions for participant:",R);let e=await G({participantId:R,phase:"benchmark",count:30});console.log("[Benchmark] Loaded questions:",e),i(e)}catch(e){console.error("[Benchmark] Failed to load questions from backend:",e),A(e instanceof Error?e.message:"Failed to load questions from backend"),console.log("[Benchmark] Falling back to local question generation");try{let e=$("benchmark",30);console.log("[Benchmark] Generated local questions:",e),i(e),A(null)}catch(e){console.error("[Benchmark] Local question generation also failed:",e),A("Failed to generate questions. Please refresh the page to try again.")}}finally{I(!1)}})()},[R]),(0,r.useEffect)(()=>{if(!g&&j>0&&!y){let e=setInterval(()=>{f(e=>e<=1?(D(),0):e-1)},1e3);return()=>clearInterval(e)}},[g,j,y]);let z=(0,r.useCallback)(async()=>{w(!0);let e=Object.values(d).filter(e=>e.confirmed&&e.correct).length;Object.values(d).filter(e=>e.confirmed).length,l.length;let a={phase:"benchmark",participantId:R,data:{completed:!0,correctAnswers:e,totalQuestions:l.length,accuracy:e/l.length,timeUsed:1200-j,answers:Object.entries(d).map(e=>{let[s,t]=e;return{questionId:Number(s),selected:t.selected,correct:t.correct,confirmed:t.confirmed}})}};try{if(!(await fetch("".concat(F,"/api/v1/ingest-phase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw Error("Failed to submit benchmark test data");console.log("[Benchmark Test] Submission successful ✅"),t({benchmark:a.data,totalScore:e}),s()}catch(r){console.error("[Benchmark Test] Submission failed ❌",r),console.log("[Benchmark Test] Backend unavailable, proceeding with local data only"),t({benchmark:a.data,totalScore:e}),s()}},[d,R,l.length,j,F,t,s]);(0,r.useEffect)(()=>{if(y){let e=setTimeout(()=>{z()},100);return()=>clearTimeout(e)}},[y,z]);let D=()=>{z()},M=e=>{u(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},O=e=>{c(e)};if(T)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsx)(C,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-500 to-blue-600 rounded-2xl mb-4",children:(0,a.jsx)(L.Z,{className:"h-8 w-8 text-white animate-pulse"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Generating Test 2 Questions"}),(0,a.jsx)("p",{className:"text-gray-600 max-w-md mx-auto",children:"Creating a sophisticated test with mixed difficulty levels using academic algorithms..."}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"}),(0,a.jsx)("span",{children:"Generating 30 questions with controlled difficulty progression"})]}),E&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:["Error: ",E,(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs",children:"Falling back to backup questions..."})]})]})})})});if(g)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(el.Z,{className:"h-6 w-6 mr-2 text-purple-600"}),"Test 2 - Instructions"]})}),(0,a.jsxs)(C,{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-purple-800 mb-6",children:"Test 2"}),(0,a.jsxs)("div",{className:"space-y-6 text-purple-700",children:[(0,a.jsxs)("p",{className:"text-xl",children:["You will complete a test with ",(0,a.jsx)("strong",{children:"30 dynamically generated knapsack questions"}),". You have exactly ",(0,a.jsx)("strong",{children:"20 minutes"})," to complete the test."]}),E&&(0,a.jsx)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 mb-4",children:(0,a.jsxs)("p",{className:"text-yellow-800 text-sm",children:[(0,a.jsx)("strong",{children:"Note:"})," We encountered an issue generating questions dynamically, so we're using backup questions for this session."]})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-xl font-semibold mb-4",children:"\uD83E\uDDED Navigation"}),(0,a.jsxs)("ul",{className:"text-lg space-y-3",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"You can navigate to any question in the test at any point"})," by clicking the question menu on the left, or by clicking the arrow buttons on every question."]}),(0,a.jsx)("li",{children:'• You can "highlight" questions by clicking the star icon on the menu.'}),(0,a.jsxs)("li",{children:["• As before, ",(0,a.jsx)("strong",{children:"please remember to confirm questions you wish to answer"}),". You cannot change your answer after confirming, but you can still view them by moving to the question."]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg",children:[(0,a.jsx)("h4",{className:"text-xl font-semibold mb-4",children:"\uD83C\uDFAF Assessment"}),(0,a.jsxs)("ul",{className:"text-lg space-y-3",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Correct answers"}),": You are rewarded 2 ",(0,a.jsx)("strong",{children:"probability points"})]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Incorrect answers"}),": You are NOT rewarded ",(0,a.jsx)("strong",{children:"probability points"})]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Unanswered questions"}),": You are rewarded 1 ",(0,a.jsx)("strong",{children:"probability point"})]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Must confirm answers to count"})]})]})]})]}),(0,a.jsx)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-6",children:(0,a.jsxs)("p",{className:"text-xl text-yellow-800 font-medium",children:["\uD83D\uDCA1 ",(0,a.jsx)("strong",{children:"Strategy Tip:"})," The test is long, and you are NOT expected to finish every question. Plan your time accordingly and focus on questions you can solve accurately."]})})]})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)(N,{onClick:()=>b(!1),size:"lg",className:"bg-purple-600 hover:bg-purple-700",disabled:0===l.length,children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 mr-2"}),"Start Test 2 (",l.length," Questions)"]})})]})]})});if(y)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsxs)(C,{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"text-lg font-medium text-gray-700",children:"Completing Test 2..."}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("div",{className:"inline-block h-4 w-4 animate-spin rounded-full border-2 border-blue-600 border-r-transparent"})})]})})});if(!l.length)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsx)(C,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:"No questions available"})})})});let W=l[n],Y=d[W.id],B=Object.keys(d).filter(e=>d[Number.parseInt(e)].confirmed).length/l.length*100;return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Test 2"}),(0,a.jsx)("div",{className:"px-3 py-2 rounded-lg text-lg font-mono font-bold ".concat(j<=60?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:(e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))})(j)})]}),(0,a.jsx)(N,{onClick:()=>P(!0),variant:"outline",className:"bg-red-50 hover:bg-red-100 border-red-200",children:"Finish Test Early"})]}),(0,a.jsxs)(v,{className:"mb-6",children:[(0,a.jsx)(k,{className:"pb-4",children:(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Question Navigation"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[Object.keys(d).filter(e=>d[Number.parseInt(e)].confirmed).length," / ",l.length," completed"]}),(0,a.jsx)(o,{value:B,className:"h-2 w-32"})]})]})})}),(0,a.jsxs)(C,{className:"p-4",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"flex space-x-3 overflow-x-auto pb-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:l.map((e,s)=>{var t;let r=s===n,l=null===(t=d[e.id])||void 0===t?void 0:t.confirmed,i=h.has(s);return(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,a.jsx)("button",{onClick:()=>O(s),className:"\n                        relative w-14 h-14 flex items-center justify-center font-bold text-lg rounded-xl transition-all duration-200 border-2\n                        ".concat(r?"bg-blue-500 text-white shadow-lg scale-110 border-blue-600":l?"bg-green-100 text-green-800 hover:bg-green-200 border-green-300":"bg-gray-100 text-gray-600 hover:bg-gray-200 border-gray-300","\n                      "),children:s+1}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),M(s)},className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center ".concat(i?"bg-yellow-500 text-white":"bg-gray-200 text-gray-400 hover:bg-gray-300"),children:(0,a.jsx)(ei.Z,{className:"h-3 w-3",fill:i?"currentColor":"none"})})]},e.id)})})}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Legend:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded border-2 border-blue-600"}),(0,a.jsx)("span",{children:"Current"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-green-100 border-2 border-green-300 rounded"}),(0,a.jsx)("span",{children:"Completed"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-gray-100 border-2 border-gray-300 rounded"}),(0,a.jsx)("span",{children:"Not answered"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(ei.Z,{className:"w-2 h-2 text-white fill-current"})}),(0,a.jsx)("span",{children:"Starred"})]})]})})]})]}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(v,{children:[(0,a.jsx)(k,{className:"pb-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold",children:["Question ",n+1," of ",l.length]}),(null==Y?void 0:Y.confirmed)&&(0,a.jsx)(x,{variant:"secondary",className:"bg-green-100 text-green-800",children:"✓ Confirmed"})]})})}),(0,a.jsxs)(C,{children:[!(null==Y?void 0:Y.confirmed)&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-yellow-800 font-medium",children:"⚠️ Remember to confirm your answer if you wish to submit it! Unconfirmed answers are considered unanswered."})}),(0,a.jsx)(Q,{question:W,onAnswer:(e,s)=>{let t=l[n].id;m(a=>({...a,[t]:{selected:e,confirmed:!0,correct:s}}))},isInteractive:!(null==Y?void 0:Y.confirmed),isTestMode:!0,initialSelection:(null==Y?void 0:Y.selected)||[],isConfirmed:(null==Y?void 0:Y.confirmed)||!1}),(null==Y?void 0:Y.confirmed)&&(0,a.jsx)("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-green-800 font-medium",children:"✓ Answer confirmed. You can still view this question but cannot change your answer."})}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-8 pt-6 border-t",children:[(0,a.jsxs)(N,{variant:"outline",size:"lg",onClick:()=>O(Math.max(0,n-1)),disabled:0===n,className:"flex items-center space-x-2",children:[(0,a.jsx)(en.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Previous"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-full",children:["Question ",n+1," of ",l.length]}),(0,a.jsxs)(N,{variant:"outline",size:"lg",onClick:()=>O(Math.min(l.length-1,n+1)),disabled:n===l.length-1,className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Next"}),(0,a.jsx)(ec.Z,{className:"h-5 w-5"})]})]})]})]})}),q&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(v,{className:"max-w-md mx-4",children:[(0,a.jsx)(k,{children:(0,a.jsx)(S,{className:"text-center text-red-600",children:"Finish Test Early?"})}),(0,a.jsxs)(C,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-3",children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"There is still time remaining!"})," Please confirm that you would like to end the test early."]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Please remember to confirm all questions you wish to answer!"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(N,{variant:"outline",onClick:()=>P(!1),className:"flex-1",children:"Continue Test"}),(0,a.jsx)(N,{onClick:()=>{P(!1),z()},className:"flex-1 bg-red-600 hover:bg-red-700",children:"End Early"})]})]})]})})]})}let ed=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{className:c("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r})});ed.displayName="Textarea";var em=t(3417),ex=t(257);let eh=[{id:1,question:"How did you approach solving the knapsack problems? Describe your general strategy.",placeholder:"Describe your problem-solving approach, any patterns you noticed, or strategies you developed..."},{id:2,question:"What factors did you consider when deciding which items to include in the knapsack?",placeholder:"Consider weight, value, ratios, combinations, time constraints, etc..."},{id:3,question:"How did you manage your time during the test? Did you change your approach as time ran out?",placeholder:"Describe your time management strategy, how you prioritized questions, etc..."},{id:4,question:"What was the most challenging aspect of the knapsack problems for you?",placeholder:"Consider computational complexity, time pressure, decision-making, etc..."},{id:5,question:"How confident are you in your performance? What do you think your score might be?",placeholder:"Reflect on your confidence level and estimate your performance..."}];function eu(e){let{onNext:s,updateParticipantData:t,benchmarkData:l}=e,[i,n]=(0,r.useState)(0),[c,o]=(0,r.useState)({}),[d,m]=(0,r.useState)(!0),[x,h]=(0,r.useState)(!1),u=(0,r.useMemo)(()=>ex.env.NEXT_PUBLIC_API_BASE||"https://knapsack-expirement.onrender.com",[]),p=(e,s)=>{o(t=>({...t,[e]:s}))},b=async()=>{let e={phase:"strategy",participantId:localStorage.getItem("participantId"),data:{completed:!0,answers:c,questionsAnswered:Object.keys(c).length,totalQuestions:eh.length}};try{if(!(await fetch("".concat(u,"/api/v1/ingest-phase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to submit strategy phase");console.log("[Strategy Phase] Submission successful ✅"),t({strategy:e.data}),s()}catch(e){console.error("[Strategy Phase] Submission failed ❌",e),alert("There was an error submitting your strategy responses.")}},f=e=>e.trim().split(/\s+/).filter(e=>e.length>0).length;if(d)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(em.Z,{className:"h-6 w-6 mr-2 text-blue-600"}),"Strategy Questions"]})}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-8 rounded-xl",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Before revealing your final score..."}),(0,a.jsxs)("div",{className:"text-left space-y-4 text-gray-700 mb-6",children:[(0,a.jsx)("p",{className:"text-lg",children:"Before revealing your final score, we ask you to complete in words, as best as you can, a list of questions around your self-evaluation and your thought process during the test."}),(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-yellow-800 font-medium",children:[(0,a.jsx)("strong",{children:"Prize Opportunity:"})," For every text response you give, we will evaluate (by both humans and an AI) how insightful your solutions are. We will randomly pick 3 fellow test takers in the top quarter of insightfulness of answers for an additional prize of $25."]})}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-blue-900 mb-2",children:"Writing Guidelines:"}),(0,a.jsxs)("ul",{className:"text-blue-800 space-y-1",children:[(0,a.jsx)("li",{children:"• Confine your responses to 150-200 words per question"}),(0,a.jsx)("li",{children:"• Shorter answers are perfectly acceptable - no penalty for brevity"}),(0,a.jsx)("li",{children:"• Focus on being insightful about your thought process"}),(0,a.jsx)("li",{children:"• Be honest about your strategies and challenges"})]})]})]}),(0,a.jsx)(N,{onClick:()=>m(!1),size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:"Begin Strategy Questions"})]})})]})});if(x){let e=Object.keys(c).length,s=Object.values(c).reduce((e,s)=>e+f(s),0);return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(I.Z,{className:"h-6 w-6 mr-2 text-green-600"}),"Strategy Questions Complete"]})}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-blue-50 p-8 rounded-xl",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Thank you for your insights!"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Questions Answered"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-blue-600",children:s}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total Words"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-purple-600",children:Math.round(s/Math.max(e,1))}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Avg Words/Question"})]})]}),(0,a.jsx)("div",{className:"bg-green-100 border border-green-300 rounded-lg p-4 mb-6",children:(0,a.jsx)("p",{className:"text-green-800 font-medium",children:"Your responses have been recorded and will be evaluated for insightfulness. Remember, the top 25% most insightful responses will be eligible for the additional $25 prize!"})}),(0,a.jsx)(N,{onClick:b,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:"Continue to Final Test"})]})})})]})})}let y=eh[i],w=c[y.id]||"",q=f(w),P=(i+1)/eh.length*100;return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Question ",i+1," of ",eh.length]}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[q," words"]})]}),(0,a.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,a.jsx)(j.E.div,{className:"bg-blue-600 h-2 rounded-full",initial:{width:0},animate:{width:"".concat(P,"%")},transition:{duration:.3}})})]}),(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 mr-2 text-blue-600"}),"Strategy Question ",i+1]})}),(0,a.jsxs)(C,{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:y.question}),(0,a.jsx)(ed,{value:w,onChange:e=>p(y.id,e.target.value),placeholder:y.placeholder,className:"min-h-[200px] text-base"}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-3",children:[(0,a.jsxs)("span",{className:"text-sm ".concat(q>200?"text-red-600":q>150?"text-yellow-600":"text-gray-500"),children:[q," words ",q>200&&"(over 200 word limit)"]}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Target: 150-200 words"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)(N,{variant:"outline",onClick:()=>{i>0&&n(i-1)},disabled:0===i,children:"Previous"}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Question ",i+1," of ",eh.length]}),(0,a.jsx)(N,{onClick:()=>{i<eh.length-1?n(i+1):h(!0)},className:"bg-blue-600 hover:bg-blue-700",children:i===eh.length-1?"Finish":"Next"})]})]})]})]})}var eg=t(257);function ep(e){let{onNext:s,updateParticipantData:t}=e,[l,i]=(0,r.useState)([]),[n,c]=(0,r.useState)(0),[d,m]=(0,r.useState)({}),[h,u]=(0,r.useState)(new Set),[b,j]=(0,r.useState)(!0),[f,y]=(0,r.useState)(1200),[w,q]=(0,r.useState)(!1),[P,T]=(0,r.useState)(!1),[I,E]=(0,r.useState)(!0),[A,R]=(0,r.useState)(null),[Z,F]=(0,r.useState)(null),z=(0,r.useMemo)(()=>eg.env.NEXT_PUBLIC_API_BASE||"https://knapsack-expirement.onrender.com",[]);(0,r.useEffect)(()=>{let e=localStorage.getItem("participantId");F(e),e||console.warn("[Final Test] No participantId in localStorage")},[]),(0,r.useEffect)(()=>{Z&&(async()=>{try{E(!0),R(null),console.log("[Final Test] Loading dynamic questions for participant:",Z);let e=await G({participantId:Z,phase:"final",count:15});console.log("[Final Test] Loaded questions:",e),i(e)}catch(e){console.error("[Final Test] Failed to load questions from backend:",e),R(e instanceof Error?e.message:"Failed to load questions from backend"),console.log("[Final Test] Falling back to local question generation");try{let e=$("prediction",15);console.log("[Final Test] Generated local questions:",e),i(e),R(null)}catch(e){console.error("[Final Test] Local question generation also failed:",e),R("Failed to generate questions. Please refresh the page to try again.")}}finally{E(!1)}})()},[Z]),(0,r.useEffect)(()=>{if(!b&&f>0&&!w){let e=setInterval(()=>{y(e=>e<=1?(D(),0):e-1)},1e3);return()=>clearInterval(e)}},[b,f,w]);let D=()=>{M()},M=async()=>{q(!0);let e=Object.values(d).filter(e=>e.confirmed&&e.correct).length;Object.values(d).filter(e=>e.confirmed).length,l.length;let a={participantId:Z,phase:"final",data:{completed:!0,correctAnswers:e,totalQuestions:l.length,performanceScore:e,timeUsed:1200-f,answers:Object.entries(d).map(e=>{let[s,t]=e;return{questionId:Number(s),selected:t.selected,confirmed:t.confirmed,correct:t.correct}})}};try{if(!(await fetch("".concat(z,"/api/v1/ingest-phase"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok)throw Error("Failed to submit final test");console.log("[Final Test] Submission successful ✅"),t({final:a.data}),s()}catch(e){console.error("[Final Test] Submission failed ❌",e),alert("There was an error submitting your final test responses.")}},O=e=>{u(s=>{let t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},W=e=>{c(e)};if(I)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsx)(C,{className:"p-8 text-center",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-red-500 to-orange-600 rounded-2xl mb-4",children:(0,a.jsx)(L.Z,{className:"h-8 w-8 text-white animate-pulse"})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Generating Final Test Questions"}),(0,a.jsx)("p",{className:"text-gray-600 max-w-md mx-auto",children:"Creating your final assessment with descending difficulty progression using our most sophisticated algorithms..."}),(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-500",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-red-500"}),(0,a.jsx)("span",{children:"Generating 15 questions with academic rigor"})]}),A&&(0,a.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:["Error: ",A,(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs",children:"Falling back to backup questions..."})]})]})})})});if(b)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 mr-2 text-red-600"}),"Final Test - Instructions"]})}),(0,a.jsxs)(C,{className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-semibold text-red-800 mb-6",children:"Final Test"}),(0,a.jsxs)("div",{className:"space-y-6 text-red-700",children:[(0,a.jsxs)("p",{className:"text-lg",children:["Welcome to the final test! You will see ",(0,a.jsxs)("strong",{children:[l.length," dynamically generated knapsack questions"]})," with descending difficulty order. As usual, we do NOT expect you to finish every question in the time given, so plan your time accordingly."]}),A&&(0,a.jsx)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-4 mb-4",children:(0,a.jsxs)("p",{className:"text-yellow-800 text-sm",children:[(0,a.jsx)("strong",{children:"Note:"})," We encountered an issue generating questions dynamically, so we're using backup questions for this session."]})}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg border-2 border-red-200",children:[(0,a.jsxs)("h4",{className:"text-lg font-semibold mb-4 flex items-center",children:[(0,a.jsx)(p.Z,{className:"h-5 w-5 mr-2"}),"Assessment"]}),(0,a.jsxs)("ul",{className:"text-base space-y-2",children:[(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Correct answers"}),": Contribute to your performance assessment"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Incorrect answers"}),": Do not contribute to your assessment"]}),(0,a.jsxs)("li",{children:["• ",(0,a.jsx)("strong",{children:"Unanswered questions"}),": Considered neutral"]}),(0,a.jsx)("li",{children:"• Must confirm answers to count"})]})]}),(0,a.jsx)("div",{className:"bg-yellow-100 border border-yellow-300 rounded-lg p-6",children:(0,a.jsxs)("p",{className:"text-lg text-yellow-800 font-medium",children:["\uD83D\uDCA1 ",(0,a.jsx)("strong",{children:"Strategy Note:"})," The test is long, and you are NOT expected to finish every question. Plan your time accordingly and focus on questions you can solve accurately."]})})]})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)(N,{onClick:()=>{j(!1)},size:"lg",className:"bg-red-600 hover:bg-red-700",disabled:0===l.length,children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 mr-2"}),"Start Final Test (",l.length," Questions)"]})})]})]})});if(w){let e=Object.values(d).filter(e=>e.confirmed&&e.correct).length,t=Object.values(d).filter(e=>e.confirmed).length,r=l.length-t,i=Object.values(d).filter(e=>e.confirmed&&!e.correct).length;return(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,a.jsxs)(v,{className:"shadow-lg",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center",children:[(0,a.jsx)(g.Z,{className:"h-6 w-6 mr-2 text-green-600"}),"Final Test Complete!"]})}),(0,a.jsx)(C,{className:"space-y-6",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsxs)("div",{className:"bg-gradient-to-r from-emerald-50 to-teal-50 p-8 rounded-xl",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Your Final Performance"}),(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-emerald-600",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Correct"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-amber-600",children:r}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Unanswered"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-rose-600",children:i}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Incorrect"})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow-sm border-2 border-teal-500",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-teal-600",children:e}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Performance Score"})]})]}),(0,a.jsxs)("div",{className:"bg-teal-100 border border-teal-300 rounded-lg p-4 mb-6",children:[(0,a.jsxs)("p",{className:"text-teal-800 font-medium",children:["You completed the test with a performance score of ",(0,a.jsx)("strong",{children:e}),"!"]}),(0,a.jsx)("p",{className:"text-teal-700 text-sm mt-1",children:"Thank you for participating in this study."})]}),(0,a.jsx)(N,{onClick:s,size:"lg",children:"Continue to Question Analysis"})]})})})]})})}if(!l.length)return(0,a.jsx)("div",{className:"max-w-7xl mx-auto p-6",children:(0,a.jsx)(v,{className:"shadow-lg",children:(0,a.jsx)(C,{className:"p-8 text-center",children:(0,a.jsx)("div",{className:"text-gray-500",children:"No questions available"})})})});let Y=l[n],B=d[Y.id],U=Object.keys(d).filter(e=>d[Number.parseInt(e)].confirmed).length/l.length*100;return(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-6 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Final Test"}),(0,a.jsx)("div",{className:"px-3 py-2 rounded-lg text-lg font-mono font-bold ".concat(f<=300?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:(e=>{let s=Math.floor(e/60);return"".concat(s,":").concat((e%60).toString().padStart(2,"0"))})(f)})]}),(0,a.jsx)(N,{onClick:()=>T(!0),variant:"outline",className:"bg-red-50 hover:bg-red-100 border-red-200",children:"Finish Test Early"})]}),(0,a.jsxs)(v,{className:"mb-6",children:[(0,a.jsx)(k,{className:"pb-4",children:(0,a.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Question Navigation"}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[Object.keys(d).filter(e=>d[Number.parseInt(e)].confirmed).length," / ",l.length," completed"]}),(0,a.jsx)(o,{value:U,className:"h-2 w-32"})]})]})})}),(0,a.jsxs)(C,{className:"p-4",children:[(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)("div",{className:"flex space-x-3 overflow-x-auto pb-3 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:l.map((e,s)=>{var t;let r=s===n,l=null===(t=d[e.id])||void 0===t?void 0:t.confirmed,i=h.has(s);return(0,a.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,a.jsx)("button",{onClick:()=>W(s),className:"\n                        relative w-14 h-14 flex items-center justify-center font-bold text-lg rounded-xl transition-all duration-200 border-2\n                        ".concat(r?"bg-blue-500 text-white shadow-lg scale-110 border-blue-600":l?"bg-green-100 text-green-800 hover:bg-green-200 border-green-300":"bg-gray-100 text-gray-600 hover:bg-gray-200 border-gray-300","\n                      "),children:s+1}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),O(s)},className:"absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center ".concat(i?"bg-yellow-500 text-white":"bg-gray-200 text-gray-400 hover:bg-gray-300"),children:(0,a.jsx)(ei.Z,{className:"h-3 w-3",fill:i?"currentColor":"none"})})]},e.id)})})}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-6 text-sm",children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Legend:"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-blue-500 rounded border-2 border-blue-600"}),(0,a.jsx)("span",{children:"Current"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-green-100 border-2 border-green-300 rounded"}),(0,a.jsx)("span",{children:"Completed"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-gray-100 border-2 border-gray-300 rounded"}),(0,a.jsx)("span",{children:"Not answered"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:(0,a.jsx)(ei.Z,{className:"w-2 h-2 text-white fill-current"})}),(0,a.jsx)("span",{children:"Starred"})]})]})})]})]}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)(v,{children:[(0,a.jsx)(k,{className:"pb-4",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("h3",{className:"text-2xl font-bold",children:["Question ",n+1," of ",l.length]}),(null==B?void 0:B.confirmed)&&(0,a.jsx)(x,{variant:"secondary",className:"bg-green-100 text-green-800",children:"✓ Confirmed"})]})})}),(0,a.jsxs)(C,{children:[!(null==B?void 0:B.confirmed)&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-yellow-800 font-medium",children:"⚠️ Remember to confirm your answer if you wish to submit it! Unconfirmed answers are considered unanswered."})}),(0,a.jsx)(Q,{question:Y,onAnswer:(e,s)=>{let t=l[n].id;m(a=>({...a,[t]:{selected:e,confirmed:!0,correct:s}}))},isInteractive:!(null==B?void 0:B.confirmed),isTestMode:!0,initialSelection:(null==B?void 0:B.selected)||[],isConfirmed:(null==B?void 0:B.confirmed)||!1}),(null==B?void 0:B.confirmed)&&(0,a.jsx)("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-green-800 font-medium",children:"✓ Answer confirmed. You can still view this question but cannot change your answer."})}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-8 pt-6 border-t",children:[(0,a.jsxs)(N,{variant:"outline",size:"lg",onClick:()=>W(Math.max(0,n-1)),disabled:0===n,className:"flex items-center space-x-2",children:[(0,a.jsx)(en.Z,{className:"h-5 w-5"}),(0,a.jsx)("span",{children:"Previous"})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 bg-gray-50 px-3 py-1 rounded-full",children:["Question ",n+1," of ",l.length]}),(0,a.jsxs)(N,{variant:"outline",size:"lg",onClick:()=>W(Math.min(l.length-1,n+1)),disabled:n===l.length-1,className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"Next"}),(0,a.jsx)(ec.Z,{className:"h-5 w-5"})]})]})]})]})}),P&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(v,{className:"max-w-md mx-4",children:[(0,a.jsx)(k,{children:(0,a.jsx)(S,{className:"text-center text-red-600",children:"Finish Test Early?"})}),(0,a.jsxs)(C,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-3",children:[(0,a.jsxs)("p",{className:"text-gray-700",children:[(0,a.jsx)("strong",{children:"There is still time remaining!"})," Please confirm that you would like to end the test early."]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Please remember to confirm all questions you wish to answer!"})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(N,{variant:"outline",onClick:()=>T(!1),className:"flex-1",children:"Continue Test"}),(0,a.jsx)(N,{onClick:()=>{T(!1),M()},className:"flex-1 bg-red-600 hover:bg-red-700",children:"End Early"})]})]})]})})]})}var eb=t(2023);function ej(e){let{participantData:s}=e,t=s.training1||{correctAnswers:0,totalQuestions:6,accuracy:0},r=s.training2||{correctAnswers:0,totalQuestions:10,totalPoints:0},l=s.benchmark||{correctAnswers:0,totalQuestions:30,totalPoints:0},i=s.prediction||{correctAnswers:0,totalQuestions:30,totalPoints:0},n=s.totalPoints||0;return(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,a.jsx)(v,{className:"text-center shadow-lg bg-gradient-to-br from-purple-50 to-blue-50",children:(0,a.jsxs)(k,{children:[(0,a.jsx)("div",{className:"mx-auto w-20 h-20 bg-gradient-to-br from-purple-500 to-blue-600 rounded-full flex items-center justify-center mb-4",children:(0,a.jsx)(b.Z,{className:"h-10 w-10 text-white"})}),(0,a.jsx)(S,{className:"text-3xl font-bold text-gray-900",children:"Experiment Complete!"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 mt-2",children:"Thank you for participating in the Knapsack Challenge"})]})}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)(v,{className:"border-2 border-green-200",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-lg",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 mr-2 text-green-600"}),"Practice Round"]})}),(0,a.jsx)(C,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Correct Answers:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[t.correctAnswers,"/",t.totalQuestions]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Accuracy:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[(100*t.accuracy).toFixed(0),"%"]})]}),(0,a.jsx)(o,{value:100*t.accuracy,className:"h-2"})]})})]}),(0,a.jsxs)(v,{className:"border-2 border-orange-200",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-lg",children:[(0,a.jsx)(el.Z,{className:"h-5 w-5 mr-2 text-orange-600"}),"Skills Assessment"]})}),(0,a.jsx)(C,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Correct Answers:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[r.correctAnswers,"/",r.totalQuestions]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Points Earned:"}),(0,a.jsx)("span",{className:"font-semibold text-orange-600",children:r.totalPoints})]}),(0,a.jsx)(o,{value:r.correctAnswers/r.totalQuestions*100,className:"h-2"})]})})]}),(0,a.jsxs)(v,{className:"border-2 border-purple-200",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-lg",children:[(0,a.jsx)(b.Z,{className:"h-5 w-5 mr-2 text-purple-600"}),"Benchmark Test"]})}),(0,a.jsx)(C,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Correct Answers:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[l.correctAnswers,"/",l.totalQuestions]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Points Earned:"}),(0,a.jsx)("span",{className:"font-semibold text-purple-600",children:l.totalPoints})]}),(0,a.jsx)(o,{value:l.correctAnswers/l.totalQuestions*100,className:"h-2"})]})})]}),(0,a.jsxs)(v,{className:"border-2 border-red-200",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-lg",children:[(0,a.jsx)(g.Z,{className:"h-5 w-5 mr-2 text-red-600"}),"Final Test"]})}),(0,a.jsx)(C,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Correct Answers:"}),(0,a.jsxs)("span",{className:"font-semibold",children:[i.correctAnswers,"/",i.totalQuestions]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Points Earned:"}),(0,a.jsx)("span",{className:"font-semibold text-red-600",children:i.totalPoints})]}),(0,a.jsx)(o,{value:i.correctAnswers/i.totalQuestions*100,className:"h-2"})]})})]}),(0,a.jsxs)(v,{className:"border-2 border-blue-200 bg-blue-50 md:col-span-2",children:[(0,a.jsx)(k,{className:"pb-3",children:(0,a.jsxs)(S,{className:"flex items-center text-lg",children:[(0,a.jsx)(ei.Z,{className:"h-5 w-5 mr-2 text-blue-600"}),"Overall Performance"]})}),(0,a.jsx)(C,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Total Points:"}),(0,a.jsx)("span",{className:"font-bold text-2xl text-blue-600",children:n})]}),(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(x,{className:"bg-blue-600 text-white",children:"Excellent Performance!"})})]})})]})]}),(0,a.jsxs)(v,{className:"shadow-lg bg-gradient-to-br from-green-50 to-blue-50",children:[(0,a.jsx)(k,{children:(0,a.jsxs)(S,{className:"flex items-center justify-center text-2xl",children:[(0,a.jsx)(eb.Z,{className:"h-8 w-8 mr-3 text-green-600"}),"Study Complete"]})}),(0,a.jsx)(C,{className:"text-center space-y-6",children:(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg border-2 border-green-200",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4 text-green-800",children:"Thank you for your valuable contribution to our research!"}),(0,a.jsx)("p",{className:"text-green-700",children:"Your participation helps us understand how people approach complex problem-solving tasks. All data collected will be used to advance research in cognitive science and algorithm design."})]})})]}),(0,a.jsxs)(v,{className:"bg-gray-50",children:[(0,a.jsx)(k,{children:(0,a.jsx)(S,{className:"text-xl",children:"About This Study"})}),(0,a.jsxs)(C,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-700",children:"This experiment investigated how people approach optimization problems under different conditions. The knapsack problem is a classic algorithmic challenge used in computer science and operations research."}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"What we studied:"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("li",{children:"• Problem-solving strategies under time pressure"}),(0,a.jsx)("li",{children:"• How question ordering affects performance"}),(0,a.jsx)("li",{children:"• Strategic decision-making in optimization tasks"}),(0,a.jsx)("li",{children:"• Cognitive approaches to complex problems"})]})]}),(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg",children:[(0,a.jsx)("h4",{className:"font-semibold mb-2",children:"Your contribution:"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 space-y-1",children:[(0,a.jsx)("li",{children:"• Provided valuable data on human problem-solving"}),(0,a.jsx)("li",{children:"• Helped understand cognitive strategies"}),(0,a.jsx)("li",{children:"• Contributed to algorithm design research"}),(0,a.jsx)("li",{children:"• Advanced our knowledge of decision-making"})]})]})]}),(0,a.jsx)("div",{className:"text-center pt-4",children:(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"All data collected is anonymized and will be used solely for research purposes. Thank you for your valuable participation!"})})]})]})]})}async function ef(e){try{let s=await fetch("".concat("https://knapsack-expirement.onrender.com","/api/v1/check-participant/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)return{exists:!1,completed:!1};return await s.json()}catch(e){return console.error("[Check Participant] API error:",e),{exists:!1,completed:!1}}}async function ey(e,s,t){let a=await fetch("".concat("https://knapsack-expirement.onrender.com","/api/v1/register-prolific"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prolificPid:e,studyId:s,sessionId:t})});if(!a.ok){let e=await a.json().catch(()=>({}));if(403===a.status&&e.completed)throw Error("Participant has already completed the study");throw Error("Failed to register Prolific participant")}return(await a.json()).participantId}let ew=[{id:"intro",name:"Welcome",icon:h.Z,color:"bg-blue-500"},{id:"tutorial",name:"Tutorial",icon:u.Z,color:"bg-green-500"},{id:"training1",name:"Practice",icon:g.Z,color:"bg-yellow-500"},{id:"training2",name:"Skills Test",icon:p.Z,color:"bg-orange-500"},{id:"benchmark",name:"Benchmark",icon:b.Z,color:"bg-purple-500"},{id:"strategy",name:"Strategy",icon:u.Z,color:"bg-indigo-500"},{id:"prediction",name:"Final Test",icon:g.Z,color:"bg-red-500"},{id:"results",name:"Results",icon:h.Z,color:"bg-emerald-500"}];function eN(){var e;let[s,t]=(0,r.useState)("intro"),[l,i]=(0,r.useState)(null),[n,c]=(0,r.useState)({totalScore:0,completedPhases:[],performance:{},benchmark:null}),[d,m]=(0,r.useState)({prolificPid:null,studyId:null,sessionId:null}),[h,u]=(0,r.useState)(!1),[g,p]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=new URLSearchParams(window.location.search),s=e.get("PROLIFIC_PID"),t=e.get("STUDY_ID"),a=e.get("SESSION_ID");if(m({prolificPid:s,studyId:t,sessionId:a}),!s||!t||!a){console.error("[Security] Access denied: Missing required Prolific parameters"),u(!1);return}console.log("[Registration] Checking if participant already exists:",s),ef(s).then(e=>{if(e.exists&&e.completed){console.log("[Registration] Participant has already completed the study"),u(!1),p(!0);return}if(e.exists&&!e.completed&&e.participantId){console.log("[Registration] Found existing participant, allowing continuation"),i(e.participantId),localStorage.setItem("participantId",e.participantId),localStorage.setItem("prolificPid",s),u(!0);return}if(!e.exists)return console.log("[Registration] Registering new participant:",s),ey(s,t,a);console.error("[Registration] Unexpected participant status:",e),u(!1)}).then(e=>{e&&(console.log("[Registration] Setting participant ID:",e),i(e),localStorage.setItem("participantId",e),localStorage.setItem("prolificPid",s),console.log("[Registration] Saved participant ID to localStorage"),u(!0))}).catch(e=>{if(console.error("[Registration] Failed to register participant:",e),e.message.includes("already completed"))p(!0);else{console.log("[Registration] Backend unavailable, checking localStorage fallback");let e=localStorage.getItem("participantId"),t=localStorage.getItem("prolificPid");e&&t===s?(console.log("[Registration] Using localStorage fallback for:",s),i(e),u(!0)):u(!1)}})},[]);let y=ew.findIndex(e=>e.id===s),w=(y+1)/ew.length*100,N=()=>{let e=y+1;e<ew.length?t(ew[e].id):v()},v=async()=>{if(d.prolificPid&&l){try{await fetch("".concat("https://knapsack-expirement.onrender.com","/api/v1/complete-participant"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({participantId:l,prolificPid:d.prolificPid,completedAt:new Date().toISOString()})}),console.log("[Completion] Marked participant as completed")}catch(e){console.error("[Completion] Failed to mark participant as completed:",e)}localStorage.removeItem("participantId"),localStorage.removeItem("prolificPid"),console.log("[Completion] Cleared localStorage to prevent repeat access"),window.location.href="https://app.prolific.co/submissions/complete?cc=KNAPSACK2024"}},k=e=>{c(s=>({...s,...e}))};return g?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto p-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Study Already Completed"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"You have already completed this study. Each participant can only take the study once."}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:(0,a.jsx)("p",{className:"text-blue-800 text-sm font-medium",children:"✓ Your previous submission has been recorded and you should have received completion confirmation."})}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Thank you for your participation! If you have any questions, please contact the researcher."})]})})}):h?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-gray-100",children:[(0,a.jsx)("header",{className:"bg-white/80 backdrop-blur-xl shadow-lg border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-20",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(b.Z,{className:"h-7 w-7 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Knapsack Study"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Interactive Problem Solving"})]})]}),l&&(0,a.jsxs)(x,{variant:"outline",className:"text-sm bg-blue-50 border-blue-200 text-blue-700",children:["Participant ID: ",l]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Progress"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:[y+1," / ",ew.length]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Score"}),(0,a.jsx)("div",{className:"text-lg font-bold text-blue-600",children:n.totalScore})]})]})]})})}),(0,a.jsx)("div",{className:"bg-white/60 backdrop-blur-xl border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:null===(e=ew[y])||void 0===e?void 0:e.name}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:[Math.round(w),"% Complete"]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(o,{value:w,className:"h-3 bg-gray-200"})}),(0,a.jsx)("div",{className:"flex justify-between mt-6",children:ew.map((e,s)=>{let t=e.icon,r=s===y,l=s<y;return(0,a.jsxs)(j.E.div,{className:"flex flex-col items-center",whileHover:{scale:1.05},transition:{duration:.2},children:[(0,a.jsx)("div",{className:"\n                    w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-lg transition-all duration-300\n                    ".concat(r?"bg-gradient-to-br from-blue-500 to-purple-600 ring-4 ring-blue-200":l?"bg-gradient-to-br from-green-500 to-emerald-600":"bg-gray-300","\n                  "),children:l?(0,a.jsx)(b.Z,{className:"h-6 w-6"}):(0,a.jsx)(t,{className:"h-6 w-6"})}),(0,a.jsx)("span",{className:"\n                    text-xs mt-2 text-center font-medium px-2 py-1 rounded-full\n                    ".concat(r?"text-blue-900 bg-blue-100":l?"text-green-900 bg-green-100":"text-gray-600","\n                  "),children:e.name})]},e.id)})})]})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)(f.M,{mode:"wait",children:(0,a.jsx)(j.E.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},transition:{duration:.4,ease:"easeInOut"},children:(()=>{let e={onNext:N,participantData:n,updateParticipantData:k};switch(s){case"intro":default:return(0,a.jsx)(P,{...e});case"tutorial":return(0,a.jsx)(W,{...e});case"training1":return(0,a.jsx)(es,{...e});case"training2":return(0,a.jsx)(er,{...e});case"benchmark":return(0,a.jsx)(eo,{...e});case"strategy":return(0,a.jsx)(eu,{...e,benchmarkData:n.benchmark||{}});case"prediction":return(0,a.jsx)(ep,{...e});case"results":return(0,a.jsx)(ej,{...e})}})()},s)})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto p-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"This study can only be accessed through Prolific. Please use the link provided in your Prolific study invitation."}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"If you believe this is an error, please contact the researcher."})]})})})}}},function(e){e.O(0,[562,971,117,744],function(){return e(e.s=6909)}),_N_E=e.O()}]);