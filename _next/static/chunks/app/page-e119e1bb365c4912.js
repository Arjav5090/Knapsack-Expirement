(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6909:function(e,t,r){Promise.resolve().then(r.bind(r,7340))},7340:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return I}});var a=r(7437),s=r(2265),i=r(2759),n=r(7414),l=r(4972),c=r(8896),o=r(1723),d=r(9474),m=r(8239),x=r(8614),u=r(7855);let h=(0,s.lazy)(()=>r.e(443).then(r.bind(r,443))),p=(0,s.lazy)(()=>Promise.all([r.e(132),r.e(995)]).then(r.bind(r,1995))),g=(0,s.lazy)(()=>Promise.all([r.e(132),r.e(889),r.e(302)]).then(r.bind(r,1302))),f=(0,s.lazy)(()=>Promise.all([r.e(132),r.e(52)]).then(r.bind(r,7052))),b=(0,s.lazy)(()=>Promise.all([r.e(132),r.e(889),r.e(876)]).then(r.bind(r,9876))),j=(0,s.lazy)(()=>r.e(812).then(r.bind(r,8812))),y=(0,s.lazy)(()=>Promise.all([r.e(132),r.e(889),r.e(452)]).then(r.bind(r,9452))),v=(0,s.lazy)(()=>r.e(612).then(r.bind(r,4612))),N=()=>(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-r-transparent mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}),w=[{id:"intro",name:"Welcome",icon:n.Z,color:"bg-blue-500"},{id:"tutorial",name:"Tutorial",icon:l.Z,color:"bg-green-500"},{id:"training1",name:"Practice",icon:c.Z,color:"bg-yellow-500"},{id:"training2",name:"Skills Test",icon:o.Z,color:"bg-orange-500"},{id:"benchmark",name:"Benchmark",icon:d.Z,color:"bg-purple-500"},{id:"strategy",name:"Strategy",icon:l.Z,color:"bg-indigo-500"},{id:"prediction",name:"Final Test",icon:c.Z,color:"bg-red-500"},{id:"results",name:"Results",icon:n.Z,color:"bg-emerald-500"}];function I(){var e;let[t,r]=(0,s.useState)("intro"),[n,l]=(0,s.useState)(null),[c,o]=(0,s.useState)({totalScore:0,completedPhases:[],performance:{},benchmark:null}),[I,k]=(0,s.useState)({prolificPid:null,studyId:null,sessionId:null}),[S,P]=(0,s.useState)(!1),[C,E]=(0,s.useState)(!1),[T,D]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=!1,t=new URLSearchParams(window.location.search),r=t.get("PROLIFIC_PID"),a=t.get("STUDY_ID"),s=t.get("SESSION_ID");if(k({prolificPid:r,studyId:a,sessionId:s}),!r||!a||!s){P(!1),D(!1);return}return u.hi.checkParticipant(r).then(t=>{if(!e){if(t.exists&&t.completed){localStorage.removeItem("participantId"),localStorage.removeItem("prolificPid"),P(!1),E(!0),D(!1);return}if(t.exists&&!t.completed&&t.participantId){let e=t.participantId,a=localStorage.getItem("participantId");a!==e&&(console.warn("[Participant Mismatch] Cached: ".concat(a,", Backend: ").concat(e,". Using backend ID.")),localStorage.removeItem("participantId"),localStorage.removeItem("prolificPid")),l(e),localStorage.setItem("participantId",e),localStorage.setItem("prolificPid",r),P(!0),D(!1);return}if(!t.exists&&a&&s)return u.hi.registerProlific(r,a,s).then(t=>{if(e)return;let a=t.participantId;localStorage.removeItem("participantId"),localStorage.removeItem("prolificPid"),l(a),localStorage.setItem("participantId",a),localStorage.setItem("prolificPid",r),P(!0),D(!1)}).catch(t=>{if(!e)return console.error("[Registration Error]",t),u.hi.checkParticipant(r).then(t=>{e||(t.exists&&t.participantId?(l(t.participantId),localStorage.setItem("participantId",t.participantId),localStorage.setItem("prolificPid",r),P(!0)):P(!1),D(!1))})});P(!1),D(!1)}}).catch(t=>{var r;e||(console.error("[Check Participant Error]",t),(null===(r=t.message)||void 0===r?void 0:r.includes("already completed"))&&E(!0),P(!1),D(!1))}),()=>{e=!0}},[]);let M=(0,s.useMemo)(()=>w.findIndex(e=>e.id===t),[t]),_=(0,s.useMemo)(()=>(M+1)/w.length*100,[M]),z=(0,s.useCallback)(()=>{let e=M+1;e<w.length&&r(w[e].id)},[M]);(0,s.useCallback)(async()=>{if(I.prolificPid&&n){try{await u.hi.post("/api/v1/complete-participant",{participantId:n,prolificPid:I.prolificPid,completedAt:new Date().toISOString()})}catch(e){console.error("[Completion] Failed to mark participant as completed:",e)}localStorage.removeItem("participantId"),localStorage.removeItem("prolificPid"),window.location.href="https://app.prolific.co/submissions/complete?cc=KNAPSACK2024"}},[I.prolificPid,n]);let A=(0,s.useCallback)(e=>{o(t=>({...t,...e}))},[]),L=(0,s.useMemo)(()=>({onNext:z,participantData:c,updateParticipantData:A}),[z,c,A]),Z=(0,s.useMemo)(()=>{switch(t){case"intro":default:return(0,a.jsx)(h,{...L});case"tutorial":return(0,a.jsx)(p,{...L});case"training1":return(0,a.jsx)(g,{...L});case"training2":return(0,a.jsx)(f,{...L});case"benchmark":return(0,a.jsx)(b,{...L});case"strategy":return(0,a.jsx)(j,{...L,benchmarkData:c.benchmark||{}});case"prediction":return(0,a.jsx)(y,{...L});case"results":return(0,a.jsx)(v,{...L})}},[t,L,c.benchmark]);return T?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"max-w-md mx-auto p-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-blue-600 border-r-transparent"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Verifying Access"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Checking your Prolific credentials and study status..."})]})})}):C?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto p-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Response Already Submitted"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"You have already submitted your response for this study. You are not allowed to submit again."}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsx)("p",{className:"text-red-800 text-sm font-medium",children:"\uD83D\uDEAB Multiple submissions are not permitted. Your original response has been recorded."})}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Thank you for your participation! If you have any questions, please contact the researcher."})]})})}):S?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-gray-100",children:[(0,a.jsx)("header",{className:"bg-white/80 backdrop-blur-xl shadow-lg border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-20",children:[(0,a.jsx)("div",{className:"flex items-center space-x-6",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,a.jsx)(d.Z,{className:"h-7 w-7 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Knapsack Study"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Interactive Problem Solving"})]})]})}),(0,a.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Progress"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:[M+1," / ",w.length]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Score"}),(0,a.jsx)("div",{className:"text-lg font-bold text-blue-600",children:c.totalScore})]})]})]})})}),(0,a.jsx)("div",{className:"bg-white/60 backdrop-blur-xl border-b border-gray-200",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("span",{className:"text-lg font-semibold text-gray-900",children:null===(e=w[M])||void 0===e?void 0:e.name}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 bg-gray-100 px-3 py-1 rounded-full",children:[Math.round(_),"% Complete"]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(i.E,{value:_,className:"h-3 bg-gray-200"})}),(0,a.jsx)("div",{className:"flex justify-between mt-6",children:w.map((e,t)=>{let r=e.icon,s=t===M,i=t<M;return(0,a.jsxs)(m.E.div,{className:"flex flex-col items-center",whileHover:{scale:1.05},transition:{duration:.2},children:[(0,a.jsx)("div",{className:"\n                    w-12 h-12 rounded-xl flex items-center justify-center text-white shadow-lg transition-all duration-300\n                    ".concat(s?"bg-gradient-to-br from-blue-500 to-purple-600 ring-4 ring-blue-200":i?"bg-gradient-to-br from-green-500 to-emerald-600":"bg-gray-300","\n                  "),children:i?(0,a.jsx)(d.Z,{className:"h-6 w-6"}):(0,a.jsx)(r,{className:"h-6 w-6"})}),(0,a.jsx)("span",{className:"\n                    text-xs mt-2 text-center font-medium px-2 py-1 rounded-full\n                    ".concat(s?"text-blue-900 bg-blue-100":i?"text-green-900 bg-green-100":"text-gray-600","\n                  "),children:e.name})]},e.id)})})]})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)(x.M,{mode:"wait",children:(0,a.jsx)(m.E.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},transition:{duration:.4,ease:"easeInOut"},children:(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)(N,{}),children:Z})},t)})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-red-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"max-w-2xl mx-auto p-8",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Access Restricted"}),(0,a.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"This study can only be accessed through Prolific. Please use the link provided in your Prolific study invitation."}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"If you believe this is an error, please contact the researcher."})]})})})}},2759:function(e,t,r){"use strict";r.d(t,{E:function(){return l}});var a=r(7437),s=r(2265),i=r(7796),n=r(4508);let l=s.forwardRef((e,t)=>{let{className:r,value:s,...l}=e;return(0,a.jsx)(i.fC,{ref:t,className:(0,n.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",r),...l,children:(0,a.jsx)(i.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(s||0),"%)")}})})});l.displayName=i.fC.displayName},7855:function(e,t,r){"use strict";r.d(t,{hi:function(){return c},r9:function(){return n}});var a=r(257);let s=new Map,i=new Map,n=()=>a.env.NEXT_PUBLIC_API_BASE||"https://knapsack-expirement.onrender.com";async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4,l=n(),c="".concat(l).concat(e),o="".concat(t.method||"GET",":").concat(c,":").concat(JSON.stringify(t.body||{}));if(r&&"GET"===t.method){let e=s.get(o);if(e&&Date.now()-e.timestamp<3e5)return e.data}if(i.has(o))return i.get(o);let d=new AbortController,m=setTimeout(()=>d.abort(),a),x=fetch(c,{...t,signal:d.signal,headers:{"Content-Type":"application/json",...t.headers}}).then(async e=>{if(clearTimeout(m),!e.ok){let t=Error((await e.json().catch(()=>({error:"HTTP ".concat(e.status,": Request failed"),status:e.status}))).error||"HTTP ".concat(e.status));throw t.status=e.status,t}return e.json()}).then(e=>(r&&"GET"===t.method&&s.set(o,{data:e,timestamp:Date.now()}),e)).finally(()=>{i.delete(o)});return i.set(o,x),x}let c={get:function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return l(e,{method:"GET"},t)},post:(e,t)=>l(e,{method:"POST",body:t?JSON.stringify(t):void 0},!1),checkParticipant:e=>c.get("/api/v1/check-participant/".concat(e),!0),registerProlific:(e,t,r)=>c.post("/api/v1/register-prolific",{prolificPid:e,studyId:t,sessionId:r})}},4508:function(e,t,r){"use strict";r.d(t,{cn:function(){return i}});var a=r(1994),s=r(3335);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.m6)((0,a.W)(t))}}},function(e){e.O(0,[929,337,971,117,744],function(){return e(e.s=6909)}),_N_E=e.O()}]);